<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gerardo Luna y Pedro Castellón">

<title>Proyecto final v3 Curso Introducción a la Ciencia de Datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#proyecto-análisis-de-la-base-ames.csv-para-predicción-de-precios-de-venta" id="toc-proyecto-análisis-de-la-base-ames.csv-para-predicción-de-precios-de-venta" class="nav-link active" data-scroll-target="#proyecto-análisis-de-la-base-ames.csv-para-predicción-de-precios-de-venta"><strong>Proyecto Análisis de la base ames.csv para predicción de precios de venta</strong></a>
  <ul class="collapse">
  <li><a href="#objetivo-predicción-de-los-precios-de-venta-de-hogares-en-ames-iowa." id="toc-objetivo-predicción-de-los-precios-de-venta-de-hogares-en-ames-iowa." class="nav-link" data-scroll-target="#objetivo-predicción-de-los-precios-de-venta-de-hogares-en-ames-iowa."><strong>1. Objetivo: Predicción de los precios de venta de hogares en Ames, Iowa.</strong></a></li>
  <li><a href="#descripción-de-las-variables" id="toc-descripción-de-las-variables" class="nav-link" data-scroll-target="#descripción-de-las-variables"><strong>3. Descripción de las variables</strong></a></li>
  <li><a href="#exploración-de-datos" id="toc-exploración-de-datos" class="nav-link" data-scroll-target="#exploración-de-datos"><strong>4. Exploración de datos</strong></a>
  <ul class="collapse">
  <li><a href="#librerías" id="toc-librerías" class="nav-link" data-scroll-target="#librerías">4.1 Librerías</a></li>
  <li><a href="#tipo-de-datos-de-cada-una-de-las-variables" id="toc-tipo-de-datos-de-cada-una-de-las-variables" class="nav-link" data-scroll-target="#tipo-de-datos-de-cada-una-de-las-variables">4.2 Tipo de datos de cada una de las variables</a></li>
  <li><a href="#variable-numérica-a-predecir.-los-estadísticos-generales-para-sale_price-son-los-siguientes" id="toc-variable-numérica-a-predecir.-los-estadísticos-generales-para-sale_price-son-los-siguientes" class="nav-link" data-scroll-target="#variable-numérica-a-predecir.-los-estadísticos-generales-para-sale_price-son-los-siguientes">4.3. Variable numérica a predecir. Los estadísticos generales para Sale_Price son los siguientes:</a></li>
  <li><a href="#datos-atípicos-en-la-variable-a-predecir" id="toc-datos-atípicos-en-la-variable-a-predecir" class="nav-link" data-scroll-target="#datos-atípicos-en-la-variable-a-predecir">4.3.1 Datos atípicos en la variable a predecir</a></li>
  <li><a href="#variable-coordenadas-geográficas" id="toc-variable-coordenadas-geográficas" class="nav-link" data-scroll-target="#variable-coordenadas-geográficas">4.4 Variable Coordenadas geográficas</a></li>
  <li><a href="#análisis-de-correlaciones-de-variables-numéricas" id="toc-análisis-de-correlaciones-de-variables-numéricas" class="nav-link" data-scroll-target="#análisis-de-correlaciones-de-variables-numéricas">4.5 Análisis de correlaciones de variables numéricas</a></li>
  <li><a href="#variables-categóricas" id="toc-variables-categóricas" class="nav-link" data-scroll-target="#variables-categóricas">4.6 Variables categóricas</a></li>
  </ul></li>
  <li><a href="#dos-modelos-de-regresión-lineal-múltiple" id="toc-dos-modelos-de-regresión-lineal-múltiple" class="nav-link" data-scroll-target="#dos-modelos-de-regresión-lineal-múltiple"><strong>5. Dos modelos de regresión lineal múltiple</strong></a>
  <ul class="collapse">
  <li><a href="#condiciones-para-el-ajuste-de-una-regresión-lineal" id="toc-condiciones-para-el-ajuste-de-una-regresión-lineal" class="nav-link" data-scroll-target="#condiciones-para-el-ajuste-de-una-regresión-lineal">5.1 Condiciones para el ajuste de una regresión lineal:</a></li>
  <li><a href="#feature-engineering-transformación-logarítmica" id="toc-feature-engineering-transformación-logarítmica" class="nav-link" data-scroll-target="#feature-engineering-transformación-logarítmica">5.2 Feature Engineering transformación logarítmica</a></li>
  <li><a href="#transformación-de-columnas" id="toc-transformación-de-columnas" class="nav-link" data-scroll-target="#transformación-de-columnas">5.4 Transformación de columnas</a></li>
  <li><a href="#pipeline-y-modelado-utilizaremos-fit-y-predict" id="toc-pipeline-y-modelado-utilizaremos-fit-y-predict" class="nav-link" data-scroll-target="#pipeline-y-modelado-utilizaremos-fit-y-predict">5.5 Pipeline y modelado Utilizaremos fit y predict</a></li>
  <li><a href="#predicciones-y-coeficientes-de-regresión" id="toc-predicciones-y-coeficientes-de-regresión" class="nav-link" data-scroll-target="#predicciones-y-coeficientes-de-regresión">5.6 Predicciones y coeficientes de regresión</a></li>
  <li><a href="#métricas-de-desempeño-con-variables-no-fusionadas" id="toc-métricas-de-desempeño-con-variables-no-fusionadas" class="nav-link" data-scroll-target="#métricas-de-desempeño-con-variables-no-fusionadas">5.7 Métricas de desempeño con variables no fusionadas</a></li>
  <li><a href="#feature-engineering-robust-scaler" id="toc-feature-engineering-robust-scaler" class="nav-link" data-scroll-target="#feature-engineering-robust-scaler">5.8 Feature Engineering Robust Scaler</a></li>
  <li><a href="#transformación-de-columnas-1" id="toc-transformación-de-columnas-1" class="nav-link" data-scroll-target="#transformación-de-columnas-1">5.9 Transformación de columnas</a></li>
  <li><a href="#análisis-del-efecto-de-la-fusión-de-categorías-de-las-casas-con-precios-más-altos." id="toc-análisis-del-efecto-de-la-fusión-de-categorías-de-las-casas-con-precios-más-altos." class="nav-link" data-scroll-target="#análisis-del-efecto-de-la-fusión-de-categorías-de-las-casas-con-precios-más-altos.">5.10 Análisis del efecto de la fusión de categorías de las casas con precios más altos.</a></li>
  <li><a href="#pipeline-y-modelado-con-fit-y-predict" id="toc-pipeline-y-modelado-con-fit-y-predict" class="nav-link" data-scroll-target="#pipeline-y-modelado-con-fit-y-predict">5.11 Pipeline y modelado con fit y predict</a></li>
  <li><a href="#predicciones-y-coeficientes-de-regresión-1" id="toc-predicciones-y-coeficientes-de-regresión-1" class="nav-link" data-scroll-target="#predicciones-y-coeficientes-de-regresión-1">5.12 Predicciones y coeficientes de regresión</a></li>
  <li><a href="#métricas-de-desempeño-con-variables-fusionadas" id="toc-métricas-de-desempeño-con-variables-fusionadas" class="nav-link" data-scroll-target="#métricas-de-desempeño-con-variables-fusionadas">5.13 Métricas de desempeño con variables fusionadas</a></li>
  <li><a href="#gráficos-de-desempeño-del-modelo" id="toc-gráficos-de-desempeño-del-modelo" class="nav-link" data-scroll-target="#gráficos-de-desempeño-del-modelo">5.14 Gráficos de desempeño del modelo</a></li>
  </ul></li>
  <li><a href="#validación-cruzada" id="toc-validación-cruzada" class="nav-link" data-scroll-target="#validación-cruzada"><strong>6. Validación cruzada</strong></a>
  <ul class="collapse">
  <li><a href="#definición-del-objeto-k-fold-cv-y-las-métricas-de-desempeño" id="toc-definición-del-objeto-k-fold-cv-y-las-métricas-de-desempeño" class="nav-link" data-scroll-target="#definición-del-objeto-k-fold-cv-y-las-métricas-de-desempeño">6.1 Definición del objeto K-Fold CV y las métricas de desempeño</a></li>
  <li><a href="#realización-de-validación-cruzada-y-cálculo-de-estadísticas" id="toc-realización-de-validación-cruzada-y-cálculo-de-estadísticas" class="nav-link" data-scroll-target="#realización-de-validación-cruzada-y-cálculo-de-estadísticas">6.2 Realización de validación cruzada y cálculo de estadísticas</a></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados">6.3 Resultados</a></li>
  </ul></li>
  <li><a href="#conclusiones-modelo-de-regresión-lineal" id="toc-conclusiones-modelo-de-regresión-lineal" class="nav-link" data-scroll-target="#conclusiones-modelo-de-regresión-lineal"><strong>7. Conclusiones Modelo de regresión lineal</strong></a></li>
  <li><a href="#k-nearest-neighbor" id="toc-k-nearest-neighbor" class="nav-link" data-scroll-target="#k-nearest-neighbor"><strong>8. K Nearest Neighbor</strong></a>
  <ul class="collapse">
  <li><a href="#pipeline-y-modelado" id="toc-pipeline-y-modelado" class="nav-link" data-scroll-target="#pipeline-y-modelado">8.1 Pipeline y modelado</a></li>
  <li><a href="#predicciones" id="toc-predicciones" class="nav-link" data-scroll-target="#predicciones">8.2 Predicciones</a></li>
  <li><a href="#métricas-de-desempeño" id="toc-métricas-de-desempeño" class="nav-link" data-scroll-target="#métricas-de-desempeño">8.3 Métricas de desempeño</a></li>
  <li><a href="#gráficos-de-desempeño-del-modelo-1" id="toc-gráficos-de-desempeño-del-modelo-1" class="nav-link" data-scroll-target="#gráficos-de-desempeño-del-modelo-1">8.4 Gráficos de desempeño del modelo</a></li>
  </ul></li>
  <li><a href="#validación-cruzada-1" id="toc-validación-cruzada-1" class="nav-link" data-scroll-target="#validación-cruzada-1"><strong>9. Validación cruzada</strong></a>
  <ul class="collapse">
  <li><a href="#predicciones-finales" id="toc-predicciones-finales" class="nav-link" data-scroll-target="#predicciones-finales">9.1 Predicciones finales</a></li>
  <li><a href="#métricas-de-desempeño-1" id="toc-métricas-de-desempeño-1" class="nav-link" data-scroll-target="#métricas-de-desempeño-1">9.2 Métricas de desempeño</a></li>
  <li><a href="#importancia-de-variables" id="toc-importancia-de-variables" class="nav-link" data-scroll-target="#importancia-de-variables">9.3 Importancia de variables</a></li>
  </ul></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><strong>10. Random Forest</strong></a>
  <ul class="collapse">
  <li><a href="#pipeline-y-modelado-1" id="toc-pipeline-y-modelado-1" class="nav-link" data-scroll-target="#pipeline-y-modelado-1">10.1 Pipeline y modelado</a></li>
  <li><a href="#predicciones-1" id="toc-predicciones-1" class="nav-link" data-scroll-target="#predicciones-1">10.2 Predicciones</a></li>
  <li><a href="#métricas-de-desempeño-2" id="toc-métricas-de-desempeño-2" class="nav-link" data-scroll-target="#métricas-de-desempeño-2">10.3 Métricas de desempeño</a></li>
  <li><a href="#gráficos-de-desempeño" id="toc-gráficos-de-desempeño" class="nav-link" data-scroll-target="#gráficos-de-desempeño">10.4 Gráficos de desempeño</a></li>
  <li><a href="#validación-cruzada-2" id="toc-validación-cruzada-2" class="nav-link" data-scroll-target="#validación-cruzada-2">10.5 Validación Cruzada</a></li>
  <li><a href="#métricas-de-desempeño-3" id="toc-métricas-de-desempeño-3" class="nav-link" data-scroll-target="#métricas-de-desempeño-3">10.6 Métricas de desempeño</a></li>
  <li><a href="#pipeline-y-modelado-2" id="toc-pipeline-y-modelado-2" class="nav-link" data-scroll-target="#pipeline-y-modelado-2">10.7 Pipeline y modelado</a></li>
  <li><a href="#creación-de-dataframe-y-selección-de-columnas-de-interés" id="toc-creación-de-dataframe-y-selección-de-columnas-de-interés" class="nav-link" data-scroll-target="#creación-de-dataframe-y-selección-de-columnas-de-interés">10.8 Creación de dataframe y selección de columnas de interés</a></li>
  <li><a href="#creación-de-gráficos" id="toc-creación-de-gráficos" class="nav-link" data-scroll-target="#creación-de-gráficos">10.9 Creación de gráficos</a></li>
  <li><a href="#predicciones-finales-1" id="toc-predicciones-finales-1" class="nav-link" data-scroll-target="#predicciones-finales-1">10.10 Predicciones finales</a></li>
  <li><a href="#métricas-de-desempeño-4" id="toc-métricas-de-desempeño-4" class="nav-link" data-scroll-target="#métricas-de-desempeño-4">10.11 Métricas de desempeño</a></li>
  <li><a href="#creación-de-gráficos-1" id="toc-creación-de-gráficos-1" class="nav-link" data-scroll-target="#creación-de-gráficos-1">10.12 Creación de gráficos</a></li>
  <li><a href="#importancia-de-variables-1" id="toc-importancia-de-variables-1" class="nav-link" data-scroll-target="#importancia-de-variables-1">10.13 Importancia de variables</a></li>
  <li><a href="#creación-de-gráficos-2" id="toc-creación-de-gráficos-2" class="nav-link" data-scroll-target="#creación-de-gráficos-2">10.14 Creación de gráficos</a></li>
  </ul></li>
  <li><a href="#conclusión-final" id="toc-conclusión-final" class="nav-link" data-scroll-target="#conclusión-final"><strong>11. Conclusión final</strong></a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Proyecto final v3 Curso Introducción a la Ciencia de Datos</h1>
<p class="subtitle lead">Predicción de precios de casas en Ames, Iowa</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Gerardo Luna y Pedro Castellón </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Fecha de publicación</div>
    <div class="quarto-title-meta-contents">
      <p class="date">18 de noviembre de 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="proyecto-análisis-de-la-base-ames.csv-para-predicción-de-precios-de-venta" class="level1">
<h1><strong>Proyecto Análisis de la base ames.csv para predicción de precios de venta</strong></h1>
<section id="objetivo-predicción-de-los-precios-de-venta-de-hogares-en-ames-iowa." class="level2">
<h2 class="anchored" data-anchor-id="objetivo-predicción-de-los-precios-de-venta-de-hogares-en-ames-iowa."><strong>1. Objetivo: Predicción de los precios de venta de hogares en Ames, Iowa.</strong></h2>
<p>El objetivo es desarrollar un modelo que prediga el precio de venta de una determinada casa en Ames, Iowa. Se asume, para este proyecto final de Introducción a la Ciencia de Datos, AMAT, que los interesados en el informe esperan conocer si el precio al que se ofrece una casa está por encima o por debajo de su valor real. Se espera que aquellas subvaluadas representen una oportunidad de inversión.</p>
<p>Para llevar a cabo una predicción del precio de venta, lo más precisa posible, es necesario aplicar las herramientas de Machine Learning que van desde el conocimiento del contenido, y contexto de la información, complementarla en caso necesario, hasta un análisis exploratorio (EDA y GEDA), desarrollo de hipótesis, implementación de algoritmos y modelos matemáticos.</p>
<p>Destacamos en el análisis exploratorio los siguientes puntos que deberemos alcanzar en este proyecto:</p>
<ol type="1">
<li><p>Maximizar el conocimiento de nuestro conjunto de datos (base ames.csv).</p></li>
<li><p>Descubrir la estructura subyacente de los datos.</p></li>
<li><p>Extraer variables importantes.</p></li>
<li><p>Detectar valores atípicos y anomalías.</p></li>
<li><p>Probar los supuestos subyacentes.</p>
<h2 id="contexto-de-los-datos" class="anchored"><strong>2. Contexto de los datos</strong></h2></li>
</ol>
<p>La base de datos que se requiere se encuentra contenida en el archivo ames.csv. El presente proyecto desarrolla el modelo de predicción, fundamentado a su vez en predictores numéricos y categóricos correspondientes a diferentes características de las viviendas de Ames, Iowa.</p>
<p>El archivo ames.csv contiene 74 variables, como se indicó, tanto numéricas como categóricas, y 2,930 registros.</p>
</section>
<section id="descripción-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="descripción-de-las-variables"><strong>3. Descripción de las variables</strong></h2>
<table class="table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS_SubClass</td>
<td>Características de la vivienda</td>
</tr>
<tr class="even">
<td>MS_Zoning</td>
<td>Zona en que se encuentra</td>
</tr>
<tr class="odd">
<td>Lot_Frontage</td>
<td>Medida del frente en pies</td>
</tr>
<tr class="even">
<td>Lot_Area</td>
<td>Superficie en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Street</td>
<td>Tipo de camino de acceso</td>
</tr>
<tr class="even">
<td>Alley</td>
<td>Tipo de callejón</td>
</tr>
<tr class="odd">
<td>Lot_Shape</td>
<td>Forma de la vivienda</td>
</tr>
<tr class="even">
<td>Land_Contour</td>
<td>Tipo de superficie</td>
</tr>
<tr class="odd">
<td>Utilities</td>
<td>Servicios disponibles</td>
</tr>
<tr class="even">
<td>Lot_Config</td>
<td>Configuración de la vivienda</td>
</tr>
<tr class="odd">
<td>Land_Slope</td>
<td>Pendiente del terreno</td>
</tr>
<tr class="even">
<td>Neighborhood</td>
<td>Barrio o colonia</td>
</tr>
<tr class="odd">
<td>Condition_1</td>
<td>Vialidades adyacentes 1</td>
</tr>
<tr class="even">
<td>Condition_2</td>
<td>Vialidades adyacentes 2</td>
</tr>
<tr class="odd">
<td>Bldg_Type</td>
<td>Tipo de construcción</td>
</tr>
<tr class="even">
<td>House_Style</td>
<td>Tipo de vivienda</td>
</tr>
<tr class="odd">
<td>Overall_Cond</td>
<td>Estado general</td>
</tr>
<tr class="even">
<td>Year_Built</td>
<td>Año de construcción</td>
</tr>
<tr class="odd">
<td>Year_Remod_Add</td>
<td>Año de remodelación</td>
</tr>
<tr class="even">
<td>Roof_Style</td>
<td>Tipo de techo</td>
</tr>
<tr class="odd">
<td>Roof_Matl</td>
<td>Material del techo</td>
</tr>
<tr class="even">
<td>Exterior_1st</td>
<td>Tipo de fachada 1</td>
</tr>
<tr class="odd">
<td>Exterior_2nd</td>
<td>Tipo de fachada 2</td>
</tr>
<tr class="even">
<td>Mas_Vnr_Type</td>
<td>Chapa mampostería tipo</td>
</tr>
<tr class="odd">
<td>Mas_Vnr_Area</td>
<td>Chapa mampostería área</td>
</tr>
<tr class="even">
<td>Exter_Cond</td>
<td>Calidad de material exterior</td>
</tr>
<tr class="odd">
<td>Foundation</td>
<td>Tipo de cimientos</td>
</tr>
<tr class="even">
<td>Bsmt_Cond</td>
<td>Estado del sótano</td>
</tr>
<tr class="odd">
<td>Bsmt_Exposure</td>
<td>Tipo de exposición del sótano</td>
</tr>
<tr class="even">
<td>BsmtFin_Type_1</td>
<td>Rating 1 de acabados del sótano</td>
</tr>
<tr class="odd">
<td>BsmtFin_SF_1</td>
<td>Pies cuadrados del sótano tipo 1</td>
</tr>
<tr class="even">
<td>BsmtFin_Type_2</td>
<td>Rating 2 de acabados del sótano</td>
</tr>
<tr class="odd">
<td>BsmtFin_SF_2</td>
<td>Pies cuadrados del sótano tipo 2</td>
</tr>
<tr class="even">
<td>Bsmt_Unf_SF</td>
<td>Pies cuadrados sin acabados del sótano</td>
</tr>
<tr class="odd">
<td>Total_Bsmt_SF</td>
<td>Area del sótano en pies cuadrados</td>
</tr>
<tr class="even">
<td>Heating</td>
<td>Tipo de calefacción</td>
</tr>
<tr class="odd">
<td>Heating_QC</td>
<td>Calidad y estado de la calefacción</td>
</tr>
<tr class="even">
<td>Central_Air</td>
<td>Aire acondicionado central</td>
</tr>
<tr class="odd">
<td>Electrical</td>
<td>Sistema de electricidad</td>
</tr>
<tr class="even">
<td>First_Flr_SF</td>
<td>Pies cuadrados del primer piso</td>
</tr>
<tr class="odd">
<td>Second_Flr_SF</td>
<td>Pies cuadrados del segundo piso</td>
</tr>
<tr class="even">
<td>Gr_Liv_Area</td>
<td>Superficie habitable</td>
</tr>
<tr class="odd">
<td>Bsmt_Full_Bath</td>
<td>Baños completos en el sótano</td>
</tr>
<tr class="even">
<td>Bsmt_Half_Bath</td>
<td>Medios baños en el sótano</td>
</tr>
<tr class="odd">
<td>Full_Bath</td>
<td>Baños completos</td>
</tr>
<tr class="even">
<td>Half_Bath</td>
<td>Medios baños</td>
</tr>
<tr class="odd">
<td>Bedroom_AbvGr</td>
<td>Recámaras</td>
</tr>
<tr class="even">
<td>Kitchen_AbvGr</td>
<td>Cocina</td>
</tr>
<tr class="odd">
<td>TotRms_AbvGrd</td>
<td>Recámaras</td>
</tr>
<tr class="even">
<td>Functional</td>
<td>Características funcionales del hogar</td>
</tr>
<tr class="odd">
<td>Fireplaces</td>
<td>Chimeneas</td>
</tr>
<tr class="even">
<td>Garage_Type</td>
<td>Tipo del garage</td>
</tr>
<tr class="odd">
<td>Garage_Finish</td>
<td>Acabado interior del garage</td>
</tr>
<tr class="even">
<td>Garage_Cars</td>
<td>Espacio en el garage</td>
</tr>
<tr class="odd">
<td>Garage_Area</td>
<td>Área del garage en pies cuadrados</td>
</tr>
<tr class="even">
<td>Garage_Cond</td>
<td>Estado del garage</td>
</tr>
<tr class="odd">
<td>Paved_Drive</td>
<td>Camino pavimentado</td>
</tr>
<tr class="even">
<td>Wood_Deck_SF</td>
<td>Terraza de madera en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Open_Porch_SF</td>
<td>Cobertizo abierto en pies cuadrados</td>
</tr>
<tr class="even">
<td>Enclosed_Porch</td>
<td>Cobertizo cerrado en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Three_season_porch</td>
<td>Cobertizo modalidad “tres temporadas”</td>
</tr>
<tr class="even">
<td>Screen_Porch</td>
<td>Cobertizo con ventanales</td>
</tr>
<tr class="odd">
<td>Pool_Area</td>
<td>Superficie de la piscina</td>
</tr>
<tr class="even">
<td>Pool_QC</td>
<td>Condiciones de la piscina</td>
</tr>
<tr class="odd">
<td>Fence</td>
<td>Calidad de la cerca</td>
</tr>
<tr class="even">
<td>Misc_Feature</td>
<td>Misceláneos (elevador, cancha de tenis, etc.)</td>
</tr>
<tr class="odd">
<td>Misc_Val</td>
<td>Valor de misceláneos</td>
</tr>
<tr class="even">
<td>Mo_Sold</td>
<td>Mes de venta</td>
</tr>
<tr class="odd">
<td>Year_Sold</td>
<td>Año de venta</td>
</tr>
<tr class="even">
<td>Sale_Type</td>
<td>Forma de pago</td>
</tr>
<tr class="odd">
<td>Sale_Condition</td>
<td>Estado de la venta</td>
</tr>
<tr class="even">
<td>Sale_Price</td>
<td>Precio de venta</td>
</tr>
<tr class="odd">
<td>Longitude</td>
<td>Longitud coordenada geográfica</td>
</tr>
<tr class="even">
<td>Latitude</td>
<td>Latitud coordenada geográfica</td>
</tr>
</tbody>
</table>
</section>
<section id="exploración-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="exploración-de-datos"><strong>4. Exploración de datos</strong></h2>
<section id="librerías" class="level3">
<h3 class="anchored" data-anchor-id="librerías">4.1 Librerías</h3>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> siuba <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plydata <span class="im">as</span> pr</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.tidy <span class="im">import</span> pivot_wider, pivot_longer</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine.data <span class="im">import</span> mpg</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.feature_selection <span class="im">import</span> ColumnSelector</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_absolute_percentage_error</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, make_scorer</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, KFold, cross_val_score, cross_validate</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.one_table_verbs <span class="im">import</span> pull</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> shuffle</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> RobustScaler</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.tidy <span class="im">import</span> pivot_longer</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> FunctionTransformer</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### lectura de archivo .csv ####</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">=</span> pd.read_csv(<span class="st">"data/ames.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tamaño de conjunto completo: "</span>, ames.shape)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tamaño de conjunto completo:  (2930, 74)</code></pre>
</div>
</div>
</section>
<section id="tipo-de-datos-de-cada-una-de-las-variables" class="level3">
<h3 class="anchored" data-anchor-id="tipo-de-datos-de-cada-una-de-las-variables">4.2 Tipo de datos de cada una de las variables</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Información del tipo de datos de cada uno de los campos que integran la base </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ames.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2930 entries, 0 to 2929
Data columns (total 74 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   MS_SubClass         2930 non-null   object 
 1   MS_Zoning           2930 non-null   object 
 2   Lot_Frontage        2930 non-null   int64  
 3   Lot_Area            2930 non-null   int64  
 4   Street              2930 non-null   object 
 5   Alley               2930 non-null   object 
 6   Lot_Shape           2930 non-null   object 
 7   Land_Contour        2930 non-null   object 
 8   Utilities           2930 non-null   object 
 9   Lot_Config          2930 non-null   object 
 10  Land_Slope          2930 non-null   object 
 11  Neighborhood        2930 non-null   object 
 12  Condition_1         2930 non-null   object 
 13  Condition_2         2930 non-null   object 
 14  Bldg_Type           2930 non-null   object 
 15  House_Style         2930 non-null   object 
 16  Overall_Cond        2930 non-null   object 
 17  Year_Built          2930 non-null   int64  
 18  Year_Remod_Add      2930 non-null   int64  
 19  Roof_Style          2930 non-null   object 
 20  Roof_Matl           2930 non-null   object 
 21  Exterior_1st        2930 non-null   object 
 22  Exterior_2nd        2930 non-null   object 
 23  Mas_Vnr_Type        1155 non-null   object 
 24  Mas_Vnr_Area        2930 non-null   int64  
 25  Exter_Cond          2930 non-null   object 
 26  Foundation          2930 non-null   object 
 27  Bsmt_Cond           2930 non-null   object 
 28  Bsmt_Exposure       2930 non-null   object 
 29  BsmtFin_Type_1      2930 non-null   object 
 30  BsmtFin_SF_1        2930 non-null   int64  
 31  BsmtFin_Type_2      2930 non-null   object 
 32  BsmtFin_SF_2        2930 non-null   int64  
 33  Bsmt_Unf_SF         2930 non-null   int64  
 34  Total_Bsmt_SF       2930 non-null   int64  
 35  Heating             2930 non-null   object 
 36  Heating_QC          2930 non-null   object 
 37  Central_Air         2930 non-null   object 
 38  Electrical          2930 non-null   object 
 39  First_Flr_SF        2930 non-null   int64  
 40  Second_Flr_SF       2930 non-null   int64  
 41  Gr_Liv_Area         2930 non-null   int64  
 42  Bsmt_Full_Bath      2930 non-null   int64  
 43  Bsmt_Half_Bath      2930 non-null   int64  
 44  Full_Bath           2930 non-null   int64  
 45  Half_Bath           2930 non-null   int64  
 46  Bedroom_AbvGr       2930 non-null   int64  
 47  Kitchen_AbvGr       2930 non-null   int64  
 48  TotRms_AbvGrd       2930 non-null   int64  
 49  Functional          2930 non-null   object 
 50  Fireplaces          2930 non-null   int64  
 51  Garage_Type         2930 non-null   object 
 52  Garage_Finish       2930 non-null   object 
 53  Garage_Cars         2930 non-null   int64  
 54  Garage_Area         2930 non-null   int64  
 55  Garage_Cond         2930 non-null   object 
 56  Paved_Drive         2930 non-null   object 
 57  Wood_Deck_SF        2930 non-null   int64  
 58  Open_Porch_SF       2930 non-null   int64  
 59  Enclosed_Porch      2930 non-null   int64  
 60  Three_season_porch  2930 non-null   int64  
 61  Screen_Porch        2930 non-null   int64  
 62  Pool_Area           2930 non-null   int64  
 63  Pool_QC             2930 non-null   object 
 64  Fence               2930 non-null   object 
 65  Misc_Feature        106 non-null    object 
 66  Misc_Val            2930 non-null   int64  
 67  Mo_Sold             2930 non-null   int64  
 68  Year_Sold           2930 non-null   int64  
 69  Sale_Type           2930 non-null   object 
 70  Sale_Condition      2930 non-null   object 
 71  Sale_Price          2930 non-null   int64  
 72  Longitude           2930 non-null   float64
 73  Latitude            2930 non-null   float64
dtypes: float64(2), int64(32), object(40)
memory usage: 1.7+ MB</code></pre>
</div>
</div>
</section>
<section id="variable-numérica-a-predecir.-los-estadísticos-generales-para-sale_price-son-los-siguientes" class="level3">
<h3 class="anchored" data-anchor-id="variable-numérica-a-predecir.-los-estadísticos-generales-para-sale_price-son-los-siguientes">4.3. Variable numérica a predecir. Los estadísticos generales para Sale_Price son los siguientes:</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> select(_.Sale_Price) <span class="op">&gt;&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> summarize(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  Mean_Sale_Price <span class="op">=</span> _.Sale_Price.mean().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  Median_Sale_Price <span class="op">=</span> _.Sale_Price.median().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  Std_Sale_Price <span class="op">=</span> _.Sale_Price.std().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  Kurtosis_Sale_Price <span class="op">=</span> _.Sale_Price.kurtosis().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean_Sale_Price</th>
<th data-quarto-table-cell-role="th">Median_Sale_Price</th>
<th data-quarto-table-cell-role="th">Std_Sale_Price</th>
<th data-quarto-table-cell-role="th">Kurtosis_Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>180796.1</td>
<td>160000.0</td>
<td>79886.7</td>
<td>5.1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> select(_.Sale_Price) <span class="op">&gt;&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a> summarize(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  Asimetria_Sale_Price <span class="op">=</span> _.Sale_Price.skew().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  Max_Sale_Price <span class="op">=</span> _.Sale_Price.<span class="bu">max</span>().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  Min_Sale_Price <span class="op">=</span> _.Sale_Price.<span class="bu">min</span>().<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Asimetria_Sale_Price</th>
<th data-quarto-table-cell-role="th">Max_Sale_Price</th>
<th data-quarto-table-cell-role="th">Min_Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.7</td>
<td>755000</td>
<td>12789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> select(_.Sale_Price) <span class="op">&gt;&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> summarize(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  Q1_Sale_Price <span class="op">=</span> _.Sale_Price.quantile(q <span class="op">=</span> <span class="fl">.25</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  Q2_Sale_Price <span class="op">=</span> _.Sale_Price.quantile(q <span class="op">=</span> <span class="fl">.5</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  Q3_Sale_Price <span class="op">=</span> _.Sale_Price.quantile(q <span class="op">=</span> <span class="fl">.75</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Q1_Sale_Price</th>
<th data-quarto-table-cell-role="th">Q2_Sale_Price</th>
<th data-quarto-table-cell-role="th">Q3_Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>129500.0</td>
<td>160000.0</td>
<td>213500.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Se trata de una distribución de datos leptocúrtica (de forma puntiaguda) y la asimetría, que es positiva, indica que el gráfico tiene cola hacia la derecha. Los datos de bigotes los usaremos en el gráfico de caja (boxplot). Siendo la media mayor que la mediana, se infiere que los datos están sesgados positivamente debido a que hay valores muy altos que tiran o jalan la media hacia arriba.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma Sale_Price</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"pink"</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, bins<span class="op">=</span><span class="dv">30</span>) <span class="op">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format()) <span class="op">+</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>comma_format()) <span class="op">+</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de precio"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>El gráfico de caja muestra un número importante de datos atípicos por encima de un precio de $338,931.00:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> ggplot() <span class="op">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a> geom_boxplot(aes(x <span class="op">=</span> <span class="dv">0</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>), color<span class="op">=</span> <span class="st">"blue"</span>, fill<span class="op">=</span> <span class="st">"lightblue"</span>) <span class="op">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a> scale_y_continuous(labels <span class="op">=</span> dollar_format(prefix<span class="op">=</span><span class="st">'$'</span>, digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>)) <span class="op">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a> theme(axis_text_x<span class="op">=</span>element_blank()) <span class="op">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> ggtitle(<span class="st">"Distribución de Precio de Venta"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="datos-atípicos-en-la-variable-a-predecir" class="level3">
<h3 class="anchored" data-anchor-id="datos-atípicos-en-la-variable-a-predecir">4.3.1 Datos atípicos en la variable a predecir</h3>
<p>Estableciendo como atípicos aquellos datos que están 1.5 veces el rango inter cuartílico (RIC) por encima del cuartil 3, tenemos lo siguiente:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  ames <span class="op">&gt;&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>( (_.Sale_Price <span class="op">&gt;</span> <span class="dv">339500</span>) ) <span class="op">&gt;&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  select (_.Overall_Cond, _.Lot_Area, _.Neighborhood, _.Heating_QC, _.Sale_Price) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Overall_Cond</th>
<th data-quarto-table-cell-role="th">Lot_Area</th>
<th data-quarto-table-cell-role="th">Neighborhood</th>
<th data-quarto-table-cell-role="th">Heating_QC</th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Average</td>
<td>53504</td>
<td>Stone_Brook</td>
<td>Excellent</td>
<td>538000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Poor</td>
<td>11394</td>
<td>Stone_Brook</td>
<td>Excellent</td>
<td>394432</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Average</td>
<td>12858</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>376162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>Average</td>
<td>10159</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>395192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>Average</td>
<td>12919</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>611657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2666</td>
<td>Excellent</td>
<td>22950</td>
<td>Old_Town</td>
<td>Excellent</td>
<td>475000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2737</td>
<td>Very_Good</td>
<td>19800</td>
<td>Edwards</td>
<td>Good</td>
<td>415000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2883</td>
<td>Average</td>
<td>5748</td>
<td>Crawford</td>
<td>Excellent</td>
<td>375000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2901</td>
<td>Average</td>
<td>11443</td>
<td>Timberland</td>
<td>Excellent</td>
<td>369900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2902</td>
<td>Average</td>
<td>11577</td>
<td>Timberland</td>
<td>Excellent</td>
<td>359900</td>
</tr>
</tbody>
</table>

<p>137 rows × 5 columns</p>
</div>
</div>
</div>
<p>De esos 137 registros, el 93% cuentan con sistema de aire acondicionado excelente.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  ames <span class="op">&gt;&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>((_.Heating_QC <span class="op">==</span> <span class="st">"Excellent"</span>) <span class="op">&amp;</span> (_.Sale_Price <span class="op">&gt;=</span> <span class="dv">339500</span>)) <span class="op">&gt;&gt;</span> select (_.Overall_Cond, _.Lot_Area, _.Neighborhood, _.Heating_QC, _.Sale_Price)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Overall_Cond</th>
<th data-quarto-table-cell-role="th">Lot_Area</th>
<th data-quarto-table-cell-role="th">Neighborhood</th>
<th data-quarto-table-cell-role="th">Heating_QC</th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Average</td>
<td>53504</td>
<td>Stone_Brook</td>
<td>Excellent</td>
<td>538000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Poor</td>
<td>11394</td>
<td>Stone_Brook</td>
<td>Excellent</td>
<td>394432</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>Average</td>
<td>12858</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>376162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>Average</td>
<td>10159</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>395192</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>Average</td>
<td>12919</td>
<td>Northridge_Heights</td>
<td>Excellent</td>
<td>611657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2461</td>
<td>Average</td>
<td>13162</td>
<td>Somerset</td>
<td>Excellent</td>
<td>405749</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2666</td>
<td>Excellent</td>
<td>22950</td>
<td>Old_Town</td>
<td>Excellent</td>
<td>475000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2883</td>
<td>Average</td>
<td>5748</td>
<td>Crawford</td>
<td>Excellent</td>
<td>375000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2901</td>
<td>Average</td>
<td>11443</td>
<td>Timberland</td>
<td>Excellent</td>
<td>369900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2902</td>
<td>Average</td>
<td>11577</td>
<td>Timberland</td>
<td>Excellent</td>
<td>359900</td>
</tr>
</tbody>
</table>

<p>128 rows × 5 columns</p>
</div>
</div>
</div>
<p>Por último, el mayor número de propiedades con precios más altos se concentra en los barrios Northridge, Northrige Heights y Stone Brook, que, como se verá más adelante, son los barrios “más caros”.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  ames <span class="op">&gt;&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>((_.Heating_QC <span class="op">==</span> <span class="st">"Excellent"</span>) <span class="op">&amp;</span> (_.Sale_Price <span class="op">&gt;=</span> <span class="dv">339500</span>)) <span class="op">&gt;&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  select(_.Neighborhood) <span class="op">&gt;&gt;</span> arrange(_.Neighborhood) <span class="op">&gt;&gt;</span> count(_.Neighborhood) </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Neighborhood</th>
<th data-quarto-table-cell-role="th">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>College_Creek</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Crawford</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gilbert</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Northridge</td>
<td>21</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Northridge_Heights</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Old_Town</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Somerset</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Stone_Brook</td>
<td>22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Timberland</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="variable-coordenadas-geográficas" class="level3">
<h3 class="anchored" data-anchor-id="variable-coordenadas-geográficas">4.4 Variable Coordenadas geográficas</h3>
<p>Es importante destacar que dentro de las variables numéricas, con formato float (enteros y decimales), se encuentran los campos Latitude y Longitude, los cuales hacen referencia a las coordenadas geográficas exactas de cada inmueble que se pueden consultar en Google Maps.</p>
<p>Si consultamos la casa más barata, y la más cara en toda la base, tenemos las imágenes siguientes, obtenidas con base en sus coordenadas geográficas:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> select(_.MS_SubClass, _.Overall_Cond, _.Latitude, _.Longitude, _.Sale_Price) <span class="op">&gt;&gt;</span> <span class="bu">filter</span>((_.Sale_Price <span class="op">==</span> _.Sale_Price.<span class="bu">min</span>()) <span class="op">|</span> (_.Sale_Price <span class="op">==</span> _.Sale_Price.<span class="bu">max</span>()))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MS_SubClass</th>
<th data-quarto-table-cell-role="th">Overall_Cond</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">181</td>
<td>One_Story_1945_and_Older</td>
<td>Poor</td>
<td>42.030388</td>
<td>-93.606789</td>
<td>12789</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1767</td>
<td>Two_Story_1946_and_Newer</td>
<td>Above_Average</td>
<td>42.051980</td>
<td>-93.657271</td>
<td>755000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://maps.app.goo.gl/PaWqu86Cy6tJtF8N9"><img src="mas_barata_ames_iowa.png" class="img-fluid figure-img" alt="Ames, Iowa"></a></p>
<figcaption class="figure-caption">Precio de Venta $12,789.00</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://maps.app.goo.gl/7N5BHB3kdyfjiWHt6"><img src="mas_cara_ames_iowa.png" class="img-fluid figure-img" alt="Ames, Iowa"></a></p>
<figcaption class="figure-caption">Precio de Venta $755,000.00</figcaption>
</figure>
</div>
<p>Da click en las imágenes para dirigirte al inmueble correspondiente en Google Maps.</p>
</section>
<section id="análisis-de-correlaciones-de-variables-numéricas" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-correlaciones-de-variables-numéricas">4.5 Análisis de correlaciones de variables numéricas</h3>
<p>Se obtienen todas las correlaciones de todas las variables numéricas.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar solo las columnas numéricas</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> ames.select_dtypes(include<span class="op">=</span>[np.number])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular la matriz de correlación</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> numeric_columns.corr()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedes imprimir la matriz de correlación completa</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(correlation_matrix)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Lot_Frontage  Lot_Area  Year_Built  Year_Remod_Add  \
Lot_Frontage            1.000000  0.136862    0.026130        0.069509   
Lot_Area                0.136862  1.000000    0.023258        0.021682   
Year_Built              0.026130  0.023258    1.000000        0.612095   
Year_Remod_Add          0.069509  0.021682    0.612095        1.000000   
Mas_Vnr_Area            0.109858  0.125950    0.306797        0.191740   
BsmtFin_SF_1            0.066707 -0.045760   -0.179373       -0.050840   
BsmtFin_SF_2           -0.005254  0.083198   -0.027328       -0.061934   
Bsmt_Unf_SF             0.139290  0.023883    0.129311        0.165397   
Total_Bsmt_SF           0.206080  0.253765    0.407764        0.298393   
First_Flr_SF            0.241707  0.332235    0.310463        0.242108   
Second_Flr_SF          -0.002813  0.032996    0.016828        0.158939   
Gr_Liv_Area             0.186767  0.285599    0.241726        0.316855   
Bsmt_Full_Bath          0.019554  0.124208    0.212119        0.134590   
Bsmt_Half_Bath         -0.031798  0.026448   -0.030515       -0.046175   
Full_Bath               0.082826  0.127433    0.469406        0.457266   
Half_Bath              -0.029367  0.035497    0.269268        0.211771   
Bedroom_AbvGr           0.112718  0.136569   -0.055093       -0.021536   
Kitchen_AbvGr           0.022127 -0.020301   -0.137852       -0.142404   
TotRms_AbvGrd           0.200488  0.216597    0.111919        0.197528   
Fireplaces              0.051240  0.256989    0.170672        0.133322   
Garage_Cars             0.142774  0.179456    0.537982        0.424416   
Garage_Area             0.186780  0.212749    0.480726        0.375566   
Wood_Deck_SF            0.001162  0.157212    0.228964        0.217857   
Open_Porch_SF           0.085480  0.103760    0.198365        0.241748   
Enclosed_Porch          0.024824  0.021868   -0.374364       -0.220383   
Three_season_porch      0.004061  0.016243    0.015803        0.037412   
Screen_Porch            0.045789  0.055044   -0.041436       -0.046888   
Pool_Area               0.109439  0.093775    0.002213       -0.011410   
Misc_Val                0.003098  0.069188   -0.011011       -0.003132   
Mo_Sold                 0.017357  0.003859    0.014577        0.018048   
Year_Sold              -0.011737 -0.023085   -0.013197        0.032652   
Sale_Price              0.201875  0.266549    0.558426        0.532974   
Longitude              -0.022051 -0.098612   -0.425568       -0.323822   
Latitude                0.046942 -0.036629    0.251397        0.181050   

                    Mas_Vnr_Area  BsmtFin_SF_1  BsmtFin_SF_2  Bsmt_Unf_SF  \
Lot_Frontage            0.109858      0.066707     -0.005254     0.139290   
Lot_Area                0.125950     -0.045760      0.083198     0.023883   
Year_Built              0.306797     -0.179373     -0.027328     0.129311   
Year_Remod_Add          0.191740     -0.050840     -0.061934     0.165397   
Mas_Vnr_Area            1.000000     -0.107222     -0.014955     0.089662   
BsmtFin_SF_1           -0.107222      1.000000     -0.121751     0.488014   
BsmtFin_SF_2           -0.014955     -0.121751      1.000000    -0.238420   
Bsmt_Unf_SF             0.089662      0.488014     -0.238420     1.000000   
Total_Bsmt_SF           0.393530     -0.163311      0.090109     0.412248   
First_Flr_SF            0.392280     -0.123074      0.084710     0.296139   
Second_Flr_SF           0.120159      0.159652     -0.098188     0.002320   
Gr_Liv_Area             0.400703      0.046419     -0.017996     0.235870   
Bsmt_Full_Bath          0.139684     -0.473424      0.163634    -0.398629   
Bsmt_Half_Bath          0.016609     -0.114581      0.099147    -0.105784   
Full_Bath               0.254471      0.051531     -0.076262     0.274901   
Half_Bath               0.188703      0.034869     -0.033004    -0.033530   
Bedroom_AbvGr           0.080590      0.108739     -0.033033     0.188508   
Kitchen_AbvGr          -0.050733      0.103491     -0.037864     0.065651   
TotRms_AbvGrd           0.278418      0.107549     -0.049288     0.251633   
Fireplaces              0.270051     -0.143130      0.067180     0.001790   
Garage_Cars             0.356831     -0.077813     -0.014118     0.180080   
Garage_Area             0.370479     -0.096932      0.003625     0.164837   
Wood_Deck_SF            0.165875     -0.146419      0.098591    -0.039285   
Open_Porch_SF           0.140003     -0.002644     -0.005516     0.119143   
Enclosed_Porch         -0.109915      0.098732      0.032415     0.006383   
Three_season_porch      0.014222     -0.048145     -0.023314    -0.005399   
Screen_Porch            0.066817     -0.044111      0.062978    -0.047945   
Pool_Area               0.004893     -0.025391      0.044403    -0.031963   
Misc_Val                0.045276     -0.042043     -0.005195    -0.010125   
Mo_Sold                -0.002358      0.017495     -0.009401     0.021915   
Year_Sold              -0.016876     -0.035765      0.007089    -0.036443   
Sale_Price              0.502196     -0.134905      0.006018     0.183308   
Longitude              -0.081546      0.061665     -0.025502    -0.048123   
Latitude                0.216882      0.005937     -0.021714     0.161017   

                    Total_Bsmt_SF  First_Flr_SF  ...  Enclosed_Porch  \
Lot_Frontage             0.206080      0.241707  ...        0.024824   
Lot_Area                 0.253765      0.332235  ...        0.021868   
Year_Built               0.407764      0.310463  ...       -0.374364   
Year_Remod_Add           0.298393      0.242108  ...       -0.220383   
Mas_Vnr_Area             0.393530      0.392280  ...       -0.109915   
BsmtFin_SF_1            -0.163311     -0.123074  ...        0.098732   
BsmtFin_SF_2             0.090109      0.084710  ...        0.032415   
Bsmt_Unf_SF              0.412248      0.296139  ...        0.006383   
Total_Bsmt_SF            1.000000      0.800429  ...       -0.084848   
First_Flr_SF             0.800429      1.000000  ...       -0.065713   
Second_Flr_SF           -0.204487     -0.250057  ...        0.055429   
Gr_Liv_Area              0.445108      0.562166  ...        0.004030   
Bsmt_Full_Bath           0.326861      0.257836  ...       -0.069014   
Bsmt_Half_Bath           0.012850      0.010469  ...       -0.009272   
Full_Bath                0.325434      0.371584  ...       -0.117795   
Half_Bath               -0.054557     -0.104203  ...       -0.081312   
Bedroom_AbvGr            0.052721      0.106648  ...        0.052115   
Kitchen_AbvGr           -0.038612      0.076025  ...        0.027911   
TotRms_AbvGrd            0.281627      0.390162  ...        0.017221   
Fireplaces               0.333467      0.406345  ...       -0.000250   
Garage_Cars              0.437856      0.439471  ...       -0.134856   
Garage_Area              0.485608      0.491208  ...       -0.108237   
Wood_Deck_SF             0.230290      0.227131  ...       -0.119136   
Open_Porch_SF            0.245941      0.238041  ...       -0.059875   
Enclosed_Porch          -0.084848     -0.065713  ...        1.000000   
Three_season_porch       0.037918      0.044061  ...       -0.032674   
Screen_Porch             0.075499      0.098316  ...       -0.063965   
Pool_Area                0.072109      0.121821  ...        0.092596   
Misc_Val                 0.083895      0.093003  ...        0.008773   
Mo_Sold                  0.017325      0.040496  ...       -0.021324   
Year_Sold               -0.010524     -0.013667  ...       -0.000505   
Sale_Price               0.632529      0.621676  ...       -0.128787   
Longitude               -0.161092     -0.135877  ...        0.140129   
Latitude                 0.175561      0.129733  ...       -0.095854   

                    Three_season_porch  Screen_Porch  Pool_Area  Misc_Val  \
Lot_Frontage                  0.004061      0.045789   0.109439  0.003098   
Lot_Area                      0.016243      0.055044   0.093775  0.069188   
Year_Built                    0.015803     -0.041436   0.002213 -0.011011   
Year_Remod_Add                0.037412     -0.046888  -0.011410 -0.003132   
Mas_Vnr_Area                  0.014222      0.066817   0.004893  0.045276   
BsmtFin_SF_1                 -0.048145     -0.044111  -0.025391 -0.042043   
BsmtFin_SF_2                 -0.023314      0.062978   0.044403 -0.005195   
Bsmt_Unf_SF                  -0.005399     -0.047945  -0.031963 -0.010125   
Total_Bsmt_SF                 0.037918      0.075499   0.072109  0.083895   
First_Flr_SF                  0.044061      0.098316   0.121821  0.093003   
Second_Flr_SF                -0.032172      0.011741   0.044602 -0.005078   
Gr_Liv_Area                   0.006481      0.086804   0.135463  0.067252   
Bsmt_Full_Bath                0.027086      0.052355   0.043730 -0.004817   
Bsmt_Half_Bath                0.026971      0.042372   0.066911  0.036996   
Full_Bath                     0.015435     -0.015130   0.028205 -0.009771   
Half_Bath                    -0.023231      0.035990   0.001515  0.026648   
Bedroom_AbvGr                -0.047151      0.009250   0.036707  0.000887   
Kitchen_AbvGr                -0.021379     -0.056337  -0.013066  0.025145   
TotRms_AbvGrd                -0.025097      0.033731   0.072103  0.061134   
Fireplaces                    0.018414      0.168004   0.098449  0.008192   
Garage_Cars                   0.023405      0.043198   0.030415 -0.016861   
Garage_Area                   0.029511      0.062598   0.053055  0.008526   
Wood_Deck_SF                 -0.003967     -0.052191   0.094156  0.056820   
Open_Porch_SF                -0.009458      0.047548   0.064135  0.077254   
Enclosed_Porch               -0.032674     -0.063965   0.092596  0.008773   
Three_season_porch            1.000000     -0.029430  -0.006501 -0.000753   
Screen_Porch                 -0.029430      1.000000   0.026383  0.007162   
Pool_Area                    -0.006501      0.026383   1.000000  0.011942   
Misc_Val                     -0.000753      0.007162   0.011942  1.000000   
Mo_Sold                       0.027229      0.028169  -0.042223  0.007333   
Year_Sold                     0.022668     -0.006116  -0.052541  0.008574   
Sale_Price                    0.032225      0.112151   0.068403 -0.015691   
Longitude                     0.023723      0.048319  -0.001729  0.008715   
Latitude                      0.004271      0.018962  -0.013976 -0.011554   

                     Mo_Sold  Year_Sold  Sale_Price  Longitude  Latitude  
Lot_Frontage        0.017357  -0.011737    0.201875  -0.022051  0.046942  
Lot_Area            0.003859  -0.023085    0.266549  -0.098612 -0.036629  
Year_Built          0.014577  -0.013197    0.558426  -0.425568  0.251397  
Year_Remod_Add      0.018048   0.032652    0.532974  -0.323822  0.181050  
Mas_Vnr_Area       -0.002358  -0.016876    0.502196  -0.081546  0.216882  
BsmtFin_SF_1        0.017495  -0.035765   -0.134905   0.061665  0.005937  
BsmtFin_SF_2       -0.009401   0.007089    0.006018  -0.025502 -0.021714  
Bsmt_Unf_SF         0.021915  -0.036443    0.183308  -0.048123  0.161017  
Total_Bsmt_SF       0.017325  -0.010524    0.632529  -0.161092  0.175561  
First_Flr_SF        0.040496  -0.013667    0.621676  -0.135877  0.129733  
Second_Flr_SF       0.013247  -0.018530    0.269373  -0.048694  0.097644  
Gr_Liv_Area         0.043665  -0.026489    0.706780  -0.142516  0.179690  
Bsmt_Full_Bath     -0.003322   0.044805    0.275823  -0.114529 -0.015952  
Bsmt_Half_Bath      0.022741  -0.019556   -0.035817   0.052260 -0.039032  
Full_Bath           0.046032  -0.004754    0.545604  -0.228773  0.214763  
Half_Bath          -0.001311   0.001561    0.285056  -0.118501  0.167289  
Bedroom_AbvGr       0.053677  -0.018008    0.143913  -0.038976  0.017599  
Kitchen_AbvGr       0.035201   0.035421   -0.119814   0.067370 -0.074570  
TotRms_AbvGrd       0.043784  -0.030498    0.495474  -0.086322  0.148099  
Fireplaces          0.032152  -0.007612    0.474558  -0.057514  0.146768  
Garage_Cars         0.050728  -0.021990    0.647562  -0.216828  0.260615  
Garage_Area         0.040391  -0.012556    0.640138  -0.208203  0.211960  
Wood_Deck_SF        0.016974   0.000882    0.327143  -0.144560  0.034529  
Open_Porch_SF       0.033651  -0.037467    0.312951  -0.095491  0.087910  
Enclosed_Porch     -0.021324  -0.000505   -0.128787   0.140129 -0.095854  
Three_season_porch  0.027229   0.022668    0.032225   0.023723  0.004271  
Screen_Porch        0.028169  -0.006116    0.112151   0.048319  0.018962  
Pool_Area          -0.042223  -0.052541    0.068403  -0.001729 -0.013976  
Misc_Val            0.007333   0.008574   -0.015691   0.008715 -0.011554  
Mo_Sold             1.000000  -0.155554    0.035259   0.038735  0.043667  
Year_Sold          -0.155554   1.000000   -0.030569   0.003935 -0.011345  
Sale_Price          0.035259  -0.030569    1.000000  -0.251397  0.290891  
Longitude           0.038735   0.003935   -0.251397   1.000000  0.030089  
Latitude            0.043667  -0.011345    0.290891   0.030089  1.000000  

[34 rows x 34 columns]</code></pre>
</div>
</div>
<p>Revisado lo anterior, se consideran relevantes las correlaciones mayores o iguales a 0.5</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> ames.select_dtypes(include<span class="op">=</span>[np.number])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular las correlaciones entre todas las variables numéricas</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> numeric_columns.corr()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterar a través de las correlaciones y mostrar las que son mayores o iguales a 0.5</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column1 <span class="kw">in</span> correlation_matrix.columns:</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column2 <span class="kw">in</span> correlation_matrix.columns:</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        correlation <span class="op">=</span> correlation_matrix.loc[column1, column2]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> column1 <span class="op">!=</span> column2 <span class="kw">and</span> <span class="bu">abs</span>(correlation) <span class="op">&gt;=</span> <span class="fl">0.5</span>:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Correlación entre </span><span class="sc">{</span>column1<span class="sc">}</span><span class="ss"> y </span><span class="sc">{</span>column2<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>correlation<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlación entre Year_Built y Year_Remod_Add: 0.6120952503946816
Correlación entre Year_Built y Garage_Cars: 0.5379817054609293
Correlación entre Year_Built y Sale_Price: 0.5584261057120437
Correlación entre Year_Remod_Add y Year_Built: 0.6120952503946816
Correlación entre Year_Remod_Add y Sale_Price: 0.532973754026694
Correlación entre Mas_Vnr_Area y Sale_Price: 0.5021959770445465
Correlación entre Total_Bsmt_SF y First_Flr_SF: 0.8004286876684684
Correlación entre Total_Bsmt_SF y Sale_Price: 0.6325288490320315
Correlación entre First_Flr_SF y Total_Bsmt_SF: 0.8004286876684684
Correlación entre First_Flr_SF y Gr_Liv_Area: 0.562165842932009
Correlación entre First_Flr_SF y Sale_Price: 0.6216760632702522
Correlación entre Second_Flr_SF y Gr_Liv_Area: 0.6552511798220086
Correlación entre Second_Flr_SF y Half_Bath: 0.6116336701499726
Correlación entre Second_Flr_SF y Bedroom_AbvGr: 0.5046505900002038
Correlación entre Second_Flr_SF y TotRms_AbvGrd: 0.5852136527493758
Correlación entre Gr_Liv_Area y First_Flr_SF: 0.562165842932009
Correlación entre Gr_Liv_Area y Second_Flr_SF: 0.6552511798220086
Correlación entre Gr_Liv_Area y Full_Bath: 0.6303208098774116
Correlación entre Gr_Liv_Area y Bedroom_AbvGr: 0.5168075108650242
Correlación entre Gr_Liv_Area y TotRms_AbvGrd: 0.8077721448904711
Correlación entre Gr_Liv_Area y Sale_Price: 0.7067799209766268
Correlación entre Full_Bath y Gr_Liv_Area: 0.6303208098774116
Correlación entre Full_Bath y TotRms_AbvGrd: 0.5285991741538512
Correlación entre Full_Bath y Sale_Price: 0.5456039005201108
Correlación entre Half_Bath y Second_Flr_SF: 0.6116336701499726
Correlación entre Bedroom_AbvGr y Second_Flr_SF: 0.5046505900002038
Correlación entre Bedroom_AbvGr y Gr_Liv_Area: 0.5168075108650242
Correlación entre Bedroom_AbvGr y TotRms_AbvGrd: 0.6726471644586508
Correlación entre TotRms_AbvGrd y Second_Flr_SF: 0.5852136527493758
Correlación entre TotRms_AbvGrd y Gr_Liv_Area: 0.8077721448904711
Correlación entre TotRms_AbvGrd y Full_Bath: 0.5285991741538512
Correlación entre TotRms_AbvGrd y Bedroom_AbvGr: 0.6726471644586508
Correlación entre Garage_Cars y Year_Built: 0.5379817054609293
Correlación entre Garage_Cars y Garage_Area: 0.8898659902448479
Correlación entre Garage_Cars y Sale_Price: 0.6475616131207715
Correlación entre Garage_Area y Garage_Cars: 0.8898659902448479
Correlación entre Garage_Area y Sale_Price: 0.6401382984873729
Correlación entre Sale_Price y Year_Built: 0.5584261057120437
Correlación entre Sale_Price y Year_Remod_Add: 0.532973754026694
Correlación entre Sale_Price y Mas_Vnr_Area: 0.5021959770445465
Correlación entre Sale_Price y Total_Bsmt_SF: 0.6325288490320315
Correlación entre Sale_Price y First_Flr_SF: 0.6216760632702522
Correlación entre Sale_Price y Gr_Liv_Area: 0.7067799209766268
Correlación entre Sale_Price y Full_Bath: 0.5456039005201108
Correlación entre Sale_Price y Garage_Cars: 0.6475616131207715
Correlación entre Sale_Price y Garage_Area: 0.6401382984873729</code></pre>
</div>
</div>
<p>Del resultado anterior, 9 variables tienen una correlación mayor o igual a 0.5 con respecto al precio de ventas:</p>
<ol type="1">
<li><p>Gr_Liv_Area: 0.707</p></li>
<li><p>Garage_Cars: 0.648</p></li>
<li><p>Garage_Area: 0.640</p></li>
<li><p>Total_Bsmt_SF: 0.633</p></li>
<li><p>First_Flr_SF: 0.622</p></li>
<li><p>Year_Built: 0.558</p></li>
<li><p>Full_Bath: 0.546</p></li>
<li><p>Year_Remod_Add: 0.533</p></li>
<li><p>Mas_Vnr_Area: 0.502</p></li>
</ol>
<p>Dada la similitud entre las variables Garage_Cars y Garace_Area, se considera sólo a la primera, que tiene un poco más de correlación.</p>
<p><strong>Area (Lot_Area)</strong></p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> select(_.MS_SubClass, _.Overall_Cond, _.Lot_Area, _.Sale_Price) <span class="op">&gt;&gt;</span> <span class="bu">filter</span>((_.Lot_Area <span class="op">==</span> _.Lot_Area.<span class="bu">min</span>()) <span class="op">|</span> (_.Lot_Area <span class="op">==</span> _.Lot_Area.<span class="bu">max</span>()))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MS_SubClass</th>
<th data-quarto-table-cell-role="th">Overall_Cond</th>
<th data-quarto-table-cell-role="th">Lot_Area</th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">935</td>
<td>Two_Story_PUD_1946_and_Newer</td>
<td>Above_Average</td>
<td>1300</td>
<td>124000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">956</td>
<td>One_Story_1946_and_Newer_All_Styles</td>
<td>Average</td>
<td>215245</td>
<td>375000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Los inmuebles en Ames, Iowa, van desde los 1,300 pies cuadrados (396 mts. cuadrados) hasta los 215,245 pies cuadrados (65,607 mts. cuadrados).</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> ames[<span class="st">'Sale_Price'</span>].corr(ames[<span class="st">'Lot_Area'</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'La correlación entre el tamaño de los lotes o área de las casas de Ames y su precio de venta es </span><span class="sc">{</span>correlation<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>correlation.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La correlación entre el tamaño de los lotes o área de las casas de Ames y su precio de venta es 0.27</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.27</code></pre>
</div>
</div>
<p>Lo anterior es indicativo de que hay una correlación débil que muestra que no es una variable que influye en el precio de venta.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Lot_Area"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  geom_point()</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p><strong>Año de construcción / remodelación (Year_Built, Year_Remod_Add)</strong></p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> ames[<span class="st">'Sale_Price'</span>].corr(ames[<span class="st">'Year_Remod_Add'</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'La correlación entre el año de construcción / remodelación y su precio de venta es </span><span class="sc">{</span>correlation<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>correlation.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La correlación entre el año de construcción / remodelación y su precio de venta es 0.53</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>0.53</code></pre>
</div>
</div>
<p>De modo que se considera que hay una correlación moderada que indica que sí es una variable que influye en el precio de venta.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Year_Remod_Add"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  geom_point()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p><strong>Baños completos (Full_Bath)</strong></p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> ames[<span class="st">'Sale_Price'</span>].corr(ames[<span class="st">'Full_Bath'</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'La correlación entre el número de baños completos en las casas de Ames y su precio de venta es </span><span class="sc">{</span>correlation<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>correlation.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La correlación entre el número de baños completos en las casas de Ames y su precio de venta es 0.55</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0.55</code></pre>
</div>
</div>
<p>Se considera que hay una correlación moderada que indica que sí es una variable que influye en el precio de venta.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"Full_Bath"</span>, color <span class="op">=</span> <span class="st">"Full_Bath"</span>))  <span class="op">+</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  geom_jitter(size <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p><strong>Lugares de estacionamiento (Garage_Cars)</strong></p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> ames[<span class="st">'Sale_Price'</span>].corr(ames[<span class="st">'Garage_Cars'</span>])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'La correlación entre el número de carros que caben en el garage de las casas de Ames y su precio de venta es </span><span class="sc">{</span>correlation<span class="sc">.</span><span class="bu">round</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>correlation.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La correlación entre el número de carros que caben en el garage de las casas de Ames y su precio de venta es 0.65</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>0.65</code></pre>
</div>
</div>
<p>Por consiguiente se considera que hay una correlación moderada que indica que sí es una variable que influye en el precio de venta.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"Garage_Cars"</span>, color <span class="op">=</span> <span class="st">"Garage_Cars"</span>))  <span class="op">+</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  geom_jitter(size <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="variables-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="variables-categóricas">4.6 Variables categóricas</h3>
<p>Las variables categóricas que se considera muestran relación con la variable a predecir Sale_Price son las siguientes:</p>
<ul>
<li><p>Barrio (Neighborhood).</p></li>
<li><p>Estado general (Overall_Cond).</p></li>
<li><p>Tipo de casa (House_Style).</p></li>
<li><p>Aire acondicionado (Heating_QC).</p></li>
</ul>
<p><strong>Barrio (Neighborhood)</strong></p>
<p>Existen 28 barrios; la mayoría de las casas se concentran en North Ames, College Creek, Old Town y Edwards (39%):</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables categóricas</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>ames[<span class="st">'Neighborhood'</span>].value_counts()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Neighborhood
North_Ames                                 443
College_Creek                              267
Old_Town                                   239
Edwards                                    194
Somerset                                   182
Northridge_Heights                         166
Gilbert                                    165
Sawyer                                     151
Northwest_Ames                             131
Sawyer_West                                125
Mitchell                                   114
Brookside                                  108
Crawford                                   103
Iowa_DOT_and_Rail_Road                      93
Timberland                                  72
Northridge                                  71
Stone_Brook                                 51
South_and_West_of_Iowa_State_University     48
Clear_Creek                                 44
Meadow_Village                              37
Briardale                                   30
Bloomington_Heights                         28
Veenker                                     24
Northpark_Villa                             23
Blueste                                     10
Greens                                       8
Green_Hills                                  2
Landmark                                     1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Los precios promedio por barrio nos indican que Northridge, Stone Brook y Northridge Heights son barrios cuyo promedio casi duplica el promedio general de las casas en Ames.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Precio de venta promedio por barrio</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a> group_by(_.Neighborhood) <span class="op">&gt;&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a> summarize(Mean_Sale_Price <span class="op">=</span> _.Sale_Price.mean().<span class="bu">round</span>(<span class="dv">0</span>) ) <span class="op">&gt;&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a> arrange(<span class="op">-</span>_.Mean_Sale_Price)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Neighborhood</th>
<th data-quarto-table-cell-role="th">Mean_Sale_Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Northridge</td>
<td>330319.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>Stone_Brook</td>
<td>324229.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Northridge_Heights</td>
<td>322018.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Green_Hills</td>
<td>280000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>Veenker</td>
<td>248315.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>Timberland</td>
<td>246600.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>Somerset</td>
<td>229707.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Clear_Creek</td>
<td>208662.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Crawford</td>
<td>207551.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>College_Creek</td>
<td>201803.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Bloomington_Heights</td>
<td>196662.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Greens</td>
<td>193531.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Gilbert</td>
<td>190647.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Northwest_Ames</td>
<td>188407.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>Sawyer_West</td>
<td>184070.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>Mitchell</td>
<td>162227.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>North_Ames</td>
<td>145097.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Blueste</td>
<td>143590.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Northpark_Villa</td>
<td>140711.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>Landmark</td>
<td>137000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>Sawyer</td>
<td>136751.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>South_and_West_of_Iowa_State_University</td>
<td>135072.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Edwards</td>
<td>130843.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Brookside</td>
<td>124756.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Old_Town</td>
<td>123992.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Briardale</td>
<td>105608.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>Iowa_DOT_and_Rail_Road</td>
<td>103753.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Meadow_Village</td>
<td>95756.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Estado general (Overall_Cond)</strong></p>
<p>Tabla de precios de venta por Estado general del inmueble, comparando las métricas básicas, en particular la relación media a mediana (sesgo).</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    group_by(_.Overall_Cond) <span class="op">&gt;&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    summarize(Q1 <span class="op">=</span> _.Sale_Price.quantile(q <span class="op">=</span> <span class="fl">.25</span>), MEDIA <span class="op">=</span> _.Sale_Price.mean().<span class="bu">round</span>(<span class="dv">1</span>), MEDIANA <span class="op">=</span> _.Sale_Price.median().<span class="bu">round</span>(<span class="dv">1</span>), Q3 <span class="op">=</span> _.Sale_Price.quantile(q <span class="op">=</span> <span class="fl">.75</span>), STDEV <span class="op">=</span> _.Sale_Price.std().<span class="bu">round</span>(<span class="dv">1</span>)) <span class="op">&gt;&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    mutate(SESGO <span class="op">=</span> if_else(_.MEDIA <span class="op">&gt;</span> _.MEDIANA, <span class="st">"DERECHA"</span>, <span class="st">"IZQUIERDA"</span>))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Overall_Cond</th>
<th data-quarto-table-cell-role="th">Q1</th>
<th data-quarto-table-cell-role="th">MEDIA</th>
<th data-quarto-table-cell-role="th">MEDIANA</th>
<th data-quarto-table-cell-role="th">Q3</th>
<th data-quarto-table-cell-role="th">STDEV</th>
<th data-quarto-table-cell-role="th">SESGO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Above_Average</td>
<td>123000.00</td>
<td>150377.9</td>
<td>142500.0</td>
<td>170000.0</td>
<td>50557.8</td>
<td>DERECHA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Average</td>
<td>145025.00</td>
<td>206027.0</td>
<td>187000.0</td>
<td>245262.5</td>
<td>87026.5</td>
<td>DERECHA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Below_Average</td>
<td>88000.00</td>
<td>120923.9</td>
<td>115000.0</td>
<td>146000.0</td>
<td>44730.4</td>
<td>DERECHA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Excellent</td>
<td>140000.00</td>
<td>199765.9</td>
<td>168000.0</td>
<td>263400.0</td>
<td>88072.4</td>
<td>DERECHA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Fair</td>
<td>67250.00</td>
<td>95994.0</td>
<td>84500.0</td>
<td>115050.0</td>
<td>38804.5</td>
<td>DERECHA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Good</td>
<td>122925.00</td>
<td>153002.0</td>
<td>139700.0</td>
<td>168500.0</td>
<td>49042.6</td>
<td>DERECHA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Poor</td>
<td>69375.00</td>
<td>116062.1</td>
<td>86000.0</td>
<td>111250.0</td>
<td>104754.0</td>
<td>DERECHA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Very_Good</td>
<td>126793.75</td>
<td>154775.5</td>
<td>141750.0</td>
<td>167125.0</td>
<td>51784.6</td>
<td>DERECHA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Very_Poor</td>
<td>58000.00</td>
<td>69981.3</td>
<td>62500.0</td>
<td>79184.5</td>
<td>20092.9</td>
<td>DERECHA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Hay inidicios de que el precio tiene relación directa con la condición general del inmueble.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a> ames <span class="op">&gt;&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  ggplot( aes( x <span class="op">=</span> <span class="st">"Overall_Cond"</span>)) <span class="op">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  geom_bar( color<span class="op">=</span> <span class="st">"darkblue"</span>, fill<span class="op">=</span> <span class="st">"cyan"</span>, alpha<span class="op">=</span> <span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> comma_format()) <span class="op">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de Condición General"</span>) <span class="op">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  theme_dark() <span class="op">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"Overall_Cond"</span>, color <span class="op">=</span> <span class="st">"Overall_Cond"</span>))  <span class="op">+</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  geom_jitter(size <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"Overall_Cond"</span>, color <span class="op">=</span> <span class="st">"Overall_Cond"</span>))  <span class="op">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  geom_boxplot(size<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a> ggplot(ames, aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>, y <span class="op">=</span> <span class="st">"Year_Remod_Add"</span>, color <span class="op">=</span> <span class="st">"Overall_Cond"</span>)) <span class="op">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  geom_point() <span class="op">+</span> geom_smooth(method <span class="op">=</span> <span class="st">"lm"</span>) <span class="op">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  facet_wrap(<span class="st">"Overall_Cond"</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p><strong>Tipo de casa (House_Style)</strong></p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"House_Style"</span>, color <span class="op">=</span> <span class="st">"House_Style"</span>))  <span class="op">+</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  geom_jitter(size <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>El mayor número de registros se agrupa en las casas clásicas de uno y dos pisos.</p>
<p><strong>Aire acondicionado (Heating_QC)</strong></p>
<p>Como se indicó anteriormente en el análisis de datos atípicos en la base de datos, el aire acondicionado juega un papel importante.</p>
<p>El gráfico siguiente, muestra que los inmuebles con aire de típico a excelente, concentran la mayor cantidad de resultados.</p>
<p>Con base en consulta en Perplexity AI (es un motor de búsqueda basado en inteligencia artificial), los inviernos son muy fríos:</p>
<p><em>Durante el invierno, la temperatura máxima diaria promedio permanece alrededor de 2°C y está nublado o mayormente nublado aproximadamente el 54% del tiempo[2]. El mes de enero es el más frío, con una temperatura media de -7°C.</em></p>
<p><a href="https://www.perplexity.ai/search/Cmo-es-el-f3bx8CCRQ_ytxJ2tGJVKbw?s=c">Enlace a Perplexity.ai consulta de temperatura en Ames, Iowa.</a></p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ames <span class="op">&gt;&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y <span class="op">=</span> <span class="st">"Sale_Price"</span>, x <span class="op">=</span> <span class="st">"Heating_QC"</span>, color <span class="op">=</span> <span class="st">"Heating_QC"</span>))  <span class="op">+</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  geom_jitter(size <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>Las variables útiles para predecir el Precio de Venta de una determinada casa en Ames, Iowa son las siguientes:</p>
<ol type="1">
<li><p>Area del sótano en pies cuadrados (Total_Bsmt_SF).</p></li>
<li><p>Superficie habitable (Gr_Liv_Area).</p></li>
<li><p>Pies cuadrados del primer piso (First_Flr_SF).</p></li>
<li><p>Capacidad de autos en el garage (Garage_Cars).</p></li>
<li><p>Año de remodelación (Year_Remod_Add).</p></li>
<li><p>Barrio (Neighborhood).</p></li>
<li><p>Estado general (Overall_Cond).</p></li>
</ol>
<p>Se considera importante desarrollar un modelo integral propio de la ciencia de datos para predecir mejor el precio de venta con base en éstas variables.</p>
</section>
</section>
<section id="dos-modelos-de-regresión-lineal-múltiple" class="level2">
<h2 class="anchored" data-anchor-id="dos-modelos-de-regresión-lineal-múltiple"><strong>5. Dos modelos de regresión lineal múltiple</strong></h2>
<p>Como sabemos, dado que tenemos más de una variable independiente, en lugar de una recta, el modelo es un hiperplano que se ajusta a partir de las covariables explicativas:</p>
<p><span class="math display">\[X_1, X_2, X_3, ..., X_m\]</span></p>
<p>La regresión lineal múltiple permite generar un modelo en el que el valor de la variable dependiente o respuesta (Precio de Venta) se determina a partir de un conjunto de variables independientes llamadas predictores, que revisamos en nuestro EDA más un término de error.</p>
<p><span class="math display">\[Y = \beta _0+\beta _1 X_1 + ...+\beta _m X_m+\epsilon\]</span> Y es la variable respuesta, X las variables explicativas y las betas son los coeficientes parciales de regresión.</p>
<p>Tanto en el análisis exploratorio, como en el diferencial, hemos cuidado mantener una objetividad y no caer en sesgos, para no forzar a encontrar lo que nos gustaría en los datos.</p>
<p>Se desarrollan en los siguientes puntos dos modelos de regresión, del que se seleccionará el que presenta un mejor ajuste.</p>
<section id="condiciones-para-el-ajuste-de-una-regresión-lineal" class="level3">
<h3 class="anchored" data-anchor-id="condiciones-para-el-ajuste-de-una-regresión-lineal">5.1 Condiciones para el ajuste de una regresión lineal:</h3>
<ul>
<li><p>Linealidad.</p></li>
<li><p>Distribución normal de los residuos. Ver un histograma de errores, normal centrada en cero.</p></li>
<li><p>Varianza de residuos constante (homocedasticidad).</p></li>
<li><p>Independencia. Que no exista correlación entre variables.</p></li>
</ul>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Particionamos y extraemos la variable de respuesta</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>ames_y <span class="op">=</span> ames <span class="op">&gt;&gt;</span> pull(<span class="st">"Sale_Price"</span>)    <span class="co"># ames[["Sale_Price"]]</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Se seleccionan todos los demás datos en ames_x</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>ames_x <span class="op">=</span> select(ames, <span class="op">-</span>_.Sale_Price)   <span class="co"># ames.drop('Sale_Price', axis=1)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>División de datos, tenemos conjuntos de test y train para <em>x</em> y <em>y</em></p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ames_x_train, ames_x_test, ames_y_train, ames_y_test <span class="op">=</span> train_test_split(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a> ames_x, ames_y, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a> test_size <span class="op">=</span> <span class="fl">0.20</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a> random_state <span class="op">=</span> <span class="dv">195</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-engineering-transformación-logarítmica" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering-transformación-logarítmica">5.2 Feature Engineering transformación logarítmica</h3>
<p>Selección de variables</p>
<p>Utilizaremos nuestro Dataframe con 8 variables explicativas, 6 numéricas y 2 categóricas (<em>mutate</em> para verificar que el tipo de datos se mantenga conforme a lo requerido):</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionamos las variales numéricas de interés</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"Total_Bsmt_SF"</span>, <span class="st">"Gr_Liv_Area"</span>, <span class="st">"Year_Remod_Add"</span>, <span class="st">"First_Flr_SF"</span>,  <span class="st">"Garage_Cars"</span>, <span class="st">'Full_Bath'</span>]</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionamos las variables categóricas de interés</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">"Overall_Cond"</span>, <span class="st">"Neighborhood"</span>]  <span class="co"># R2 = 0.820</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#cat_cols = ["Overall_Cond"]  # R2 = .0751</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#cat_cols = ["Neighborhood"]  # R2 = 0.811</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntamos todas las variables de interés, numéricas y categóricas</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>columnas_seleccionadas <span class="op">=</span> num_cols <span class="op">+</span> cat_cols</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> ColumnSelector(columnas_seleccionadas)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo con los valores que interesan:</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>ames_x_train_selected <span class="op">=</span> pipe.fit_transform(ames_x_train)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Recuperamos los nombres de las columnas</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>ames_train_selected <span class="op">=</span> (pd.DataFrame(</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  ames_x_train_selected, </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  columns <span class="op">=</span> columnas_seleccionadas) <span class="op">&gt;&gt;</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a> mutate(</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  Total_Bsmt_SF <span class="op">=</span> _.Total_Bsmt_SF.astype(<span class="bu">int</span>),</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  Gr_Liv_Area <span class="op">=</span> _.Gr_Liv_Area.astype(<span class="bu">int</span>),</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  Year_Remod_Add <span class="op">=</span> _.Year_Remod_Add.astype(<span class="bu">int</span>),</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  First_Flr_SF <span class="op">=</span> _.First_Flr_SF.astype(<span class="bu">int</span>),</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  Garage_Cars <span class="op">=</span> _.Garage_Cars.astype(<span class="bu">int</span>),</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  Full_Bath <span class="op">=</span> _.Full_Bath.astype(<span class="bu">int</span>))</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>ames_train_selected.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2344 entries, 0 to 2343
Data columns (total 8 columns):
 #   Column          Non-Null Count  Dtype 
---  ------          --------------  ----- 
 0   Total_Bsmt_SF   2344 non-null   int32 
 1   Gr_Liv_Area     2344 non-null   int32 
 2   Year_Remod_Add  2344 non-null   int32 
 3   First_Flr_SF    2344 non-null   int32 
 4   Garage_Cars     2344 non-null   int32 
 5   Full_Bath       2344 non-null   int32 
 6   Overall_Cond    2344 non-null   object
 7   Neighborhood    2344 non-null   object
dtypes: int32(6), object(2)
memory usage: 91.7+ KB</code></pre>
</div>
</div>
<p>La selección de las variables categóricas Overall_Cond o Neighborhood, por sí solas, proporcionan una <em>r2</em> de 0.751 y 0.811, respectivamente, razón por la cual se seleccionan juntas, ya que entregan una métrica de desempeño un poco mejor, de 0.820 <strong>antes de la transformación logarítmica.</strong></p>
</section>
<section id="transformación-de-columnas" class="level3">
<h3 class="anchored" data-anchor-id="transformación-de-columnas">5.4 Transformación de columnas</h3>
<ul>
<li><p>Definimos un custom_function para transformación logarítmica de dos columnas.</p></li>
<li><p>Creamos el objeto custom_transformer a utilizar en el pipeline.</p></li>
<li><p>Estandarizamos las variables numéricas separando las dos logarítmicas.</p></li>
<li><p>Procesamos las columnas categóricas.</p></li>
<li><p>Pedimos que lo demás permanezca sin cambios</p></li>
</ul>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_function(X, col1, col2):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  X[col1] <span class="op">=</span> np.log1p(X[col1].astype(<span class="bu">int</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  X[col2] <span class="op">=</span> np.log1p(X[col2].astype(<span class="bu">int</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> X</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>custom_transformer <span class="op">=</span> FunctionTransformer(custom_function, feature_names_out <span class="op">=</span> <span class="st">'one-to-one'</span>, validate<span class="op">=</span><span class="va">False</span>, kw_args<span class="op">=</span>{<span class="st">'col1'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'col2'</span>: <span class="st">'Total_Bsmt_SF'</span>})</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ColumnTransformer para aplicar transformaciones</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>      (<span class="st">'log_std_transform'</span>, Pipeline([</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>          (<span class="st">'log'</span>, custom_transformer), </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>          (<span class="st">'scaler'</span>, StandardScaler())]), [<span class="st">'Gr_Liv_Area'</span>, <span class="st">'Total_Bsmt_SF'</span>]),</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>      (<span class="st">'scaler'</span>, StandardScaler(), <span class="bu">list</span>(<span class="bu">set</span>(num_cols) <span class="op">-</span> <span class="bu">set</span>([<span class="st">"Gr_Liv_Area"</span>]) <span class="op">-</span> <span class="bu">set</span>([<span class="st">"Total_Bsmt_SF"</span>]))),</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>      (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>, sparse<span class="op">=</span><span class="va">False</span>), cat_cols)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>,  <span class="co"># Mantener las columnas restantes sin cambios</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aplicamos el ajuste y la transformación y obtenemos la matriz resultante de la dicotomización.</p>
<p>En el chunk previo se eliminó <em>verbose_feature_names_out = False</em> con la finalidad de comprobar el proceso que da lugar a la transformación de cada variable.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>transformed_data <span class="op">=</span> preprocessor.fit_transform(ames_train_selected)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>new_column_names <span class="op">=</span> preprocessor.get_feature_names_out()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  transformed_data, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>new_column_names</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz resultante de la dicotomización:  </span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(transformed_df)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>transformed_df.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      log_std_transform__Gr_Liv_Area  log_std_transform__Total_Bsmt_SF  \
0                          -0.390909                         -0.254925   
1                           0.290194                          0.531531   
2                           0.684076                         -0.391643   
3                          -0.749475                         -0.246720   
4                          -0.085401                          0.277091   
...                              ...                               ...   
2339                       -0.805101                         -0.370955   
2340                        0.658057                          0.634670   
2341                       -1.801026                         -0.077967   
2342                        1.600098                          0.122640   
2343                        1.527486                         -0.205534   

      scaler__Year_Remod_Add  scaler__Garage_Cars  scaler__Full_Bath  \
0                   1.084460             0.308118           0.780752   
1                   0.988539             0.308118           0.780752   
2                  -0.977858             0.308118           0.780752   
3                  -1.601350             0.308118          -1.013446   
4                   1.036500             0.308118          -1.013446   
...                      ...                  ...                ...   
2339               -0.690093            -2.322954          -1.013446   
2340                0.940578             0.308118           0.780752   
2341               -1.649310            -1.007418          -1.013446   
2342                0.700773             0.308118           0.780752   
2343               -1.649310             0.308118           0.780752   

      scaler__First_Flr_SF  onehotencoding__Overall_Cond_Average  \
0                -1.365036                                   1.0   
1                 1.019965                                   1.0   
2                -0.075709                                   1.0   
3                -0.124122                                   1.0   
4                 0.561311                                   0.0   
...                    ...                                   ...   
2339             -1.566334                                   0.0   
2340              1.527033                                   1.0   
2341             -0.947151                                   1.0   
2342              0.785542                                   1.0   
2343              0.665782                                   1.0   

      onehotencoding__Overall_Cond_Below_Average  \
0                                            0.0   
1                                            0.0   
2                                            0.0   
3                                            0.0   
4                                            0.0   
...                                          ...   
2339                                         1.0   
2340                                         0.0   
2341                                         0.0   
2342                                         0.0   
2343                                         0.0   

      onehotencoding__Overall_Cond_Excellent  \
0                                        0.0   
1                                        0.0   
2                                        0.0   
3                                        0.0   
4                                        0.0   
...                                      ...   
2339                                     0.0   
2340                                     0.0   
2341                                     0.0   
2342                                     0.0   
2343                                     0.0   

      onehotencoding__Overall_Cond_Fair  ...  \
0                                   0.0  ...   
1                                   0.0  ...   
2                                   0.0  ...   
3                                   0.0  ...   
4                                   0.0  ...   
...                                 ...  ...   
2339                                0.0  ...   
2340                                0.0  ...   
2341                                0.0  ...   
2342                                0.0  ...   
2343                                0.0  ...   

      onehotencoding__Neighborhood_Northridge_Heights  \
0                                                 0.0   
1                                                 1.0   
2                                                 0.0   
3                                                 0.0   
4                                                 0.0   
...                                               ...   
2339                                              0.0   
2340                                              1.0   
2341                                              0.0   
2342                                              0.0   
2343                                              0.0   

      onehotencoding__Neighborhood_Northwest_Ames  \
0                                             0.0   
1                                             0.0   
2                                             0.0   
3                                             0.0   
4                                             1.0   
...                                           ...   
2339                                          0.0   
2340                                          0.0   
2341                                          0.0   
2342                                          0.0   
2343                                          0.0   

      onehotencoding__Neighborhood_Old_Town  \
0                                       0.0   
1                                       0.0   
2                                       0.0   
3                                       0.0   
4                                       0.0   
...                                     ...   
2339                                    0.0   
2340                                    0.0   
2341                                    0.0   
2342                                    0.0   
2343                                    1.0   

      onehotencoding__Neighborhood_Sawyer  \
0                                     0.0   
1                                     0.0   
2                                     0.0   
3                                     0.0   
4                                     0.0   
...                                   ...   
2339                                  0.0   
2340                                  0.0   
2341                                  0.0   
2342                                  0.0   
2343                                  0.0   

      onehotencoding__Neighborhood_Sawyer_West  \
0                                          0.0   
1                                          0.0   
2                                          0.0   
3                                          0.0   
4                                          0.0   
...                                        ...   
2339                                       0.0   
2340                                       0.0   
2341                                       0.0   
2342                                       0.0   
2343                                       0.0   

      onehotencoding__Neighborhood_Somerset  \
0                                       1.0   
1                                       0.0   
2                                       0.0   
3                                       0.0   
4                                       0.0   
...                                     ...   
2339                                    0.0   
2340                                    0.0   
2341                                    0.0   
2342                                    1.0   
2343                                    0.0   

      onehotencoding__Neighborhood_South_and_West_of_Iowa_State_University  \
0                                                   0.0                      
1                                                   0.0                      
2                                                   0.0                      
3                                                   0.0                      
4                                                   0.0                      
...                                                 ...                      
2339                                                0.0                      
2340                                                0.0                      
2341                                                0.0                      
2342                                                0.0                      
2343                                                0.0                      

      onehotencoding__Neighborhood_Stone_Brook  \
0                                          0.0   
1                                          0.0   
2                                          0.0   
3                                          0.0   
4                                          0.0   
...                                        ...   
2339                                       0.0   
2340                                       0.0   
2341                                       0.0   
2342                                       0.0   
2343                                       0.0   

      onehotencoding__Neighborhood_Timberland  \
0                                         0.0   
1                                         0.0   
2                                         0.0   
3                                         0.0   
4                                         0.0   
...                                       ...   
2339                                      0.0   
2340                                      0.0   
2341                                      0.0   
2342                                      0.0   
2343                                      0.0   

      onehotencoding__Neighborhood_Veenker  
0                                      0.0  
1                                      0.0  
2                                      0.0  
3                                      0.0  
4                                      0.0  
...                                    ...  
2339                                   0.0  
2340                                   0.0  
2341                                   0.0  
2342                                   0.0  
2343                                   0.0  

[2344 rows x 41 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2344 entries, 0 to 2343
Data columns (total 41 columns):
 #   Column                                                                Non-Null Count  Dtype  
---  ------                                                                --------------  -----  
 0   log_std_transform__Gr_Liv_Area                                        2344 non-null   float64
 1   log_std_transform__Total_Bsmt_SF                                      2344 non-null   float64
 2   scaler__Year_Remod_Add                                                2344 non-null   float64
 3   scaler__Garage_Cars                                                   2344 non-null   float64
 4   scaler__Full_Bath                                                     2344 non-null   float64
 5   scaler__First_Flr_SF                                                  2344 non-null   float64
 6   onehotencoding__Overall_Cond_Average                                  2344 non-null   float64
 7   onehotencoding__Overall_Cond_Below_Average                            2344 non-null   float64
 8   onehotencoding__Overall_Cond_Excellent                                2344 non-null   float64
 9   onehotencoding__Overall_Cond_Fair                                     2344 non-null   float64
 10  onehotencoding__Overall_Cond_Good                                     2344 non-null   float64
 11  onehotencoding__Overall_Cond_Poor                                     2344 non-null   float64
 12  onehotencoding__Overall_Cond_Very_Good                                2344 non-null   float64
 13  onehotencoding__Overall_Cond_Very_Poor                                2344 non-null   float64
 14  onehotencoding__Neighborhood_Blueste                                  2344 non-null   float64
 15  onehotencoding__Neighborhood_Briardale                                2344 non-null   float64
 16  onehotencoding__Neighborhood_Brookside                                2344 non-null   float64
 17  onehotencoding__Neighborhood_Clear_Creek                              2344 non-null   float64
 18  onehotencoding__Neighborhood_College_Creek                            2344 non-null   float64
 19  onehotencoding__Neighborhood_Crawford                                 2344 non-null   float64
 20  onehotencoding__Neighborhood_Edwards                                  2344 non-null   float64
 21  onehotencoding__Neighborhood_Gilbert                                  2344 non-null   float64
 22  onehotencoding__Neighborhood_Green_Hills                              2344 non-null   float64
 23  onehotencoding__Neighborhood_Greens                                   2344 non-null   float64
 24  onehotencoding__Neighborhood_Iowa_DOT_and_Rail_Road                   2344 non-null   float64
 25  onehotencoding__Neighborhood_Landmark                                 2344 non-null   float64
 26  onehotencoding__Neighborhood_Meadow_Village                           2344 non-null   float64
 27  onehotencoding__Neighborhood_Mitchell                                 2344 non-null   float64
 28  onehotencoding__Neighborhood_North_Ames                               2344 non-null   float64
 29  onehotencoding__Neighborhood_Northpark_Villa                          2344 non-null   float64
 30  onehotencoding__Neighborhood_Northridge                               2344 non-null   float64
 31  onehotencoding__Neighborhood_Northridge_Heights                       2344 non-null   float64
 32  onehotencoding__Neighborhood_Northwest_Ames                           2344 non-null   float64
 33  onehotencoding__Neighborhood_Old_Town                                 2344 non-null   float64
 34  onehotencoding__Neighborhood_Sawyer                                   2344 non-null   float64
 35  onehotencoding__Neighborhood_Sawyer_West                              2344 non-null   float64
 36  onehotencoding__Neighborhood_Somerset                                 2344 non-null   float64
 37  onehotencoding__Neighborhood_South_and_West_of_Iowa_State_University  2344 non-null   float64
 38  onehotencoding__Neighborhood_Stone_Brook                              2344 non-null   float64
 39  onehotencoding__Neighborhood_Timberland                               2344 non-null   float64
 40  onehotencoding__Neighborhood_Veenker                                  2344 non-null   float64
dtypes: float64(41)
memory usage: 750.9 KB</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\sklearn\preprocessing\_encoders.py:868: FutureWarning: `sparse` was renamed to `sparse_output` in version 1.2 and will be removed in 1.4. `sparse_output` is ignored unless you leave `sparse` to its default value.</code></pre>
</div>
</div>
</section>
<section id="pipeline-y-modelado-utilizaremos-fit-y-predict" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-y-modelado-utilizaremos-fit-y-predict">5.5 Pipeline y modelado Utilizaremos fit y predict</h3>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el pipeline con el feature engineering y la regresión lineal</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, LinearRegression())</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline (le damos datos entrenamiento y datos a predecir)</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_train_selected, ames_y_train)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co">'''results es un objeto que contiene toda la</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co">información de cómo se debe comportar el modelo'''</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\sklearn\preprocessing\_encoders.py:868: FutureWarning: `sparse` was renamed to `sparse_output` in version 1.2 and will be removed in 1.4. `sparse_output` is ignored unless you leave `sparse` to its default value.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>'results es un objeto que contiene toda la\ninformación de cómo se debe comportar el modelo'</code></pre>
</div>
</div>
</section>
<section id="predicciones-y-coeficientes-de-regresión" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-y-coeficientes-de-regresión">5.6 Predicciones y coeficientes de regresión</h3>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>y_pred</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> ames_y_test)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co">#ames_test.info()</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">Sale_Price_Pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>169461.897876</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>125843.689777</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>98865.749348</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>203533.454327</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>219533.877528</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>169568.786566</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>114330.004920</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>203234.838422</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>98177.738640</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>104053.050606</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
<p>Extracción de coeficientes de regresión. Utiliza la librería statsmodels</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>X_train_with_intercept <span class="op">=</span> sm.add_constant(transformed_df)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, X_train_with_intercept).fit()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>y</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.798</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.794</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>221.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 15 Nov 2023</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>16:16:23</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-27903.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>2344</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5.589e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>2302</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5.613e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>41</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>1.776e+05</td>
<td>8142.748</td>
<td>21.812</td>
<td>0.000</td>
<td>1.62e+05</td>
<td>1.94e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">log_std_transform__Gr_Liv_Area</td>
<td>2.45e+04</td>
<td>1204.952</td>
<td>20.332</td>
<td>0.000</td>
<td>2.21e+04</td>
<td>2.69e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">log_std_transform__Total_Bsmt_SF</td>
<td>5956.1824</td>
<td>802.586</td>
<td>7.421</td>
<td>0.000</td>
<td>4382.315</td>
<td>7530.050</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">scaler__Year_Remod_Add</td>
<td>6644.3293</td>
<td>1113.313</td>
<td>5.968</td>
<td>0.000</td>
<td>4461.128</td>
<td>8827.531</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">scaler__Garage_Cars</td>
<td>1.218e+04</td>
<td>1038.022</td>
<td>11.733</td>
<td>0.000</td>
<td>1.01e+04</td>
<td>1.42e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">scaler__Full_Bath</td>
<td>-584.0266</td>
<td>1148.405</td>
<td>-0.509</td>
<td>0.611</td>
<td>-2836.042</td>
<td>1667.989</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">scaler__First_Flr_SF</td>
<td>1.553e+04</td>
<td>1047.593</td>
<td>14.823</td>
<td>0.000</td>
<td>1.35e+04</td>
<td>1.76e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Average</td>
<td>-3823.8021</td>
<td>2287.347</td>
<td>-1.672</td>
<td>0.095</td>
<td>-8309.279</td>
<td>661.674</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Below_Average</td>
<td>-1.991e+04</td>
<td>4461.127</td>
<td>-4.464</td>
<td>0.000</td>
<td>-2.87e+04</td>
<td>-1.12e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Excellent</td>
<td>2.562e+04</td>
<td>6767.206</td>
<td>3.786</td>
<td>0.000</td>
<td>1.23e+04</td>
<td>3.89e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Fair</td>
<td>-2.907e+04</td>
<td>5824.820</td>
<td>-4.991</td>
<td>0.000</td>
<td>-4.05e+04</td>
<td>-1.76e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Good</td>
<td>6400.4593</td>
<td>2786.799</td>
<td>2.297</td>
<td>0.022</td>
<td>935.559</td>
<td>1.19e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Poor</td>
<td>-4.608e+04</td>
<td>1.23e+04</td>
<td>-3.759</td>
<td>0.000</td>
<td>-7.01e+04</td>
<td>-2.2e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Very_Good</td>
<td>8169.5095</td>
<td>4028.552</td>
<td>2.028</td>
<td>0.043</td>
<td>269.539</td>
<td>1.61e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Overall_Cond_Very_Poor</td>
<td>-5.97e+04</td>
<td>1.5e+04</td>
<td>-3.969</td>
<td>0.000</td>
<td>-8.92e+04</td>
<td>-3.02e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Blueste</td>
<td>-1295.7514</td>
<td>1.52e+04</td>
<td>-0.085</td>
<td>0.932</td>
<td>-3.11e+04</td>
<td>2.85e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Briardale</td>
<td>-9511.3326</td>
<td>1.12e+04</td>
<td>-0.852</td>
<td>0.394</td>
<td>-3.14e+04</td>
<td>1.24e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Brookside</td>
<td>-1.512e+04</td>
<td>9172.093</td>
<td>-1.648</td>
<td>0.099</td>
<td>-3.31e+04</td>
<td>2867.923</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Clear_Creek</td>
<td>1.086e+04</td>
<td>9916.711</td>
<td>1.095</td>
<td>0.274</td>
<td>-8590.248</td>
<td>3.03e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_College_Creek</td>
<td>1.412e+04</td>
<td>8123.402</td>
<td>1.738</td>
<td>0.082</td>
<td>-1813.024</td>
<td>3e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Crawford</td>
<td>1e+04</td>
<td>9064.826</td>
<td>1.103</td>
<td>0.270</td>
<td>-7775.381</td>
<td>2.78e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Edwards</td>
<td>-1.36e+04</td>
<td>8631.636</td>
<td>-1.576</td>
<td>0.115</td>
<td>-3.05e+04</td>
<td>3323.021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Gilbert</td>
<td>8393.2822</td>
<td>8426.473</td>
<td>0.996</td>
<td>0.319</td>
<td>-8130.989</td>
<td>2.49e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Green_Hills</td>
<td>1.429e+05</td>
<td>3.7e+04</td>
<td>3.860</td>
<td>0.000</td>
<td>7.03e+04</td>
<td>2.15e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Greens</td>
<td>3.014e+04</td>
<td>1.67e+04</td>
<td>1.801</td>
<td>0.072</td>
<td>-2683.211</td>
<td>6.3e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Iowa_DOT_and_Rail_Road</td>
<td>-2.084e+04</td>
<td>9321.980</td>
<td>-2.236</td>
<td>0.025</td>
<td>-3.91e+04</td>
<td>-2559.902</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Landmark</td>
<td>-1.518e+04</td>
<td>3.7e+04</td>
<td>-0.411</td>
<td>0.681</td>
<td>-8.77e+04</td>
<td>5.73e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Meadow_Village</td>
<td>-1.24e+04</td>
<td>1.06e+04</td>
<td>-1.167</td>
<td>0.243</td>
<td>-3.32e+04</td>
<td>8429.526</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Mitchell</td>
<td>-9672.9712</td>
<td>8733.150</td>
<td>-1.108</td>
<td>0.268</td>
<td>-2.68e+04</td>
<td>7452.692</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_North_Ames</td>
<td>-1.413e+04</td>
<td>8320.961</td>
<td>-1.698</td>
<td>0.090</td>
<td>-3.04e+04</td>
<td>2187.704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Northpark_Villa</td>
<td>-9478.0579</td>
<td>1.21e+04</td>
<td>-0.785</td>
<td>0.433</td>
<td>-3.32e+04</td>
<td>1.42e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Northridge</td>
<td>8.58e+04</td>
<td>9209.457</td>
<td>9.317</td>
<td>0.000</td>
<td>6.77e+04</td>
<td>1.04e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Northridge_Heights</td>
<td>8.323e+04</td>
<td>8347.010</td>
<td>9.971</td>
<td>0.000</td>
<td>6.69e+04</td>
<td>9.96e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Northwest_Ames</td>
<td>-9204.7207</td>
<td>8700.100</td>
<td>-1.058</td>
<td>0.290</td>
<td>-2.63e+04</td>
<td>7856.132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Old_Town</td>
<td>-3.153e+04</td>
<td>8625.144</td>
<td>-3.655</td>
<td>0.000</td>
<td>-4.84e+04</td>
<td>-1.46e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Sawyer</td>
<td>-1.159e+04</td>
<td>8667.221</td>
<td>-1.337</td>
<td>0.181</td>
<td>-2.86e+04</td>
<td>5406.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Sawyer_West</td>
<td>720.8618</td>
<td>8652.530</td>
<td>0.083</td>
<td>0.934</td>
<td>-1.62e+04</td>
<td>1.77e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Somerset</td>
<td>3.02e+04</td>
<td>8287.287</td>
<td>3.644</td>
<td>0.000</td>
<td>1.39e+04</td>
<td>4.65e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_South_and_West_of_Iowa_State_University</td>
<td>-1.682e+04</td>
<td>1.02e+04</td>
<td>-1.652</td>
<td>0.099</td>
<td>-3.68e+04</td>
<td>3148.252</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Stone_Brook</td>
<td>9.923e+04</td>
<td>9927.494</td>
<td>9.995</td>
<td>0.000</td>
<td>7.98e+04</td>
<td>1.19e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Timberland</td>
<td>2.719e+04</td>
<td>9170.846</td>
<td>2.965</td>
<td>0.003</td>
<td>9210.525</td>
<td>4.52e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">onehotencoding__Neighborhood_Veenker</td>
<td>2.659e+04</td>
<td>1.14e+04</td>
<td>2.340</td>
<td>0.019</td>
<td>4306.833</td>
<td>4.89e+04</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>894.853</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.966</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>15657.673</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>1.340</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>15.375</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>104.</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
</section>
<section id="métricas-de-desempeño-con-variables-no-fusionadas" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-con-variables-no-fusionadas">5.7 Métricas de desempeño con variables no fusionadas</h3>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">41</span>  <span class="co"># Número de predictores </span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>],</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>1280.70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>24497.20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>1460791921.48</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>38220.31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.78</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.76</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="feature-engineering-robust-scaler" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering-robust-scaler">5.8 Feature Engineering Robust Scaler</h3>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionamos las variales numéricas de interés</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">"Total_Bsmt_SF"</span>, <span class="st">"Gr_Liv_Area"</span>, <span class="st">"Year_Remod_Add"</span>, <span class="st">"First_Flr_SF"</span>,  <span class="st">"Garage_Cars"</span>, <span class="st">'Full_Bath'</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionamos las variables categóricas de interés</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">"Overall_Cond"</span>, <span class="st">"Neighborhood"</span>]  </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntamos todas las variables de interés, numéricas y categóricas</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>columnas_seleccionadas <span class="op">=</span> num_cols <span class="op">+</span> cat_cols</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> ColumnSelector(columnas_seleccionadas)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Arreglo con los valores que interesan:</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>ames_x_train_selected <span class="op">=</span> pipe.fit_transform(ames_x_train)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Recuperamos los nombres de las columnas</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>ames_train_selected <span class="op">=</span> (pd.DataFrame(</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  ames_x_train_selected, </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  columns <span class="op">=</span> columnas_seleccionadas) <span class="op">&gt;&gt;</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a> mutate(</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  Total_Bsmt_SF <span class="op">=</span> _.Total_Bsmt_SF.astype(<span class="bu">int</span>),</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  Gr_Liv_Area <span class="op">=</span> _.Gr_Liv_Area.astype(<span class="bu">int</span>),</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  Year_Remod_Add <span class="op">=</span> _.Year_Remod_Add.astype(<span class="bu">int</span>),</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  First_Flr_SF <span class="op">=</span> _.First_Flr_SF.astype(<span class="bu">int</span>),</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  Garage_Cars <span class="op">=</span> _.Garage_Cars.astype(<span class="bu">int</span>),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  Full_Bath <span class="op">=</span> _.Full_Bath.astype(<span class="bu">int</span>))</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>ames_train_selected.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2344 entries, 0 to 2343
Data columns (total 8 columns):
 #   Column          Non-Null Count  Dtype 
---  ------          --------------  ----- 
 0   Total_Bsmt_SF   2344 non-null   int32 
 1   Gr_Liv_Area     2344 non-null   int32 
 2   Year_Remod_Add  2344 non-null   int32 
 3   First_Flr_SF    2344 non-null   int32 
 4   Garage_Cars     2344 non-null   int32 
 5   Full_Bath       2344 non-null   int32 
 6   Overall_Cond    2344 non-null   object
 7   Neighborhood    2344 non-null   object
dtypes: int32(6), object(2)
memory usage: 91.7+ KB</code></pre>
</div>
</div>
</section>
<section id="transformación-de-columnas-1" class="level3">
<h3 class="anchored" data-anchor-id="transformación-de-columnas-1">5.9 Transformación de columnas</h3>
<p>Para este modelo utilizaremos Robust Scaler con la finalidad de reducir el impacto de valores atípicos o outliers dado que se advierten valores extremos que afectan negativamente las métricas.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ColumnTransformer para aplicar transformaciones</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, RobustScaler(quantile_range<span class="op">=</span>(<span class="fl">25.0</span>, <span class="fl">75.0</span>), with_centering<span class="op">=</span><span class="va">True</span>, with_scaling<span class="op">=</span><span class="va">True</span>), num_cols),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, handle_unknown<span class="op">=</span><span class="st">'ignore'</span>), cat_cols)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>transformed_data <span class="op">=</span> preprocessor.fit_transform(ames_train_selected)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>new_column_names <span class="op">=</span> preprocessor.get_feature_names_out()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  transformed_data, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>new_column_names</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz resultante de la dicotomización:  </span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(transformed_df)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>transformed_df.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Total_Bsmt_SF  Gr_Liv_Area  Year_Remod_Add  First_Flr_SF  Garage_Cars  \
0             -0.70        -0.31            0.37         -0.88         0.00   
1              1.11         0.19            0.32          0.93         0.00   
2             -0.88         0.54           -0.76          0.10         0.00   
3             -0.69        -0.54           -1.11          0.06         0.00   
4              0.34        -0.10            0.34          0.58         0.00   
...             ...          ...             ...           ...          ...   
2339          -0.86        -0.57           -0.61         -1.04        -2.00   
2340           1.50         0.51            0.29          1.31         0.00   
2341          -0.43        -1.06           -1.13         -0.57        -1.00   
2342          -0.03         1.54            0.16          0.75         0.00   
2343          -0.63         1.45           -1.13          0.66         0.00   

      Full_Bath  Overall_Cond_Average  Overall_Cond_Below_Average  \
0          0.00                  1.00                        0.00   
1          0.00                  1.00                        0.00   
2          0.00                  1.00                        0.00   
3         -1.00                  1.00                        0.00   
4         -1.00                  0.00                        0.00   
...         ...                   ...                         ...   
2339      -1.00                  0.00                        1.00   
2340       0.00                  1.00                        0.00   
2341      -1.00                  1.00                        0.00   
2342       0.00                  1.00                        0.00   
2343       0.00                  1.00                        0.00   

      Overall_Cond_Excellent  Overall_Cond_Fair  ...  \
0                       0.00               0.00  ...   
1                       0.00               0.00  ...   
2                       0.00               0.00  ...   
3                       0.00               0.00  ...   
4                       0.00               0.00  ...   
...                      ...                ...  ...   
2339                    0.00               0.00  ...   
2340                    0.00               0.00  ...   
2341                    0.00               0.00  ...   
2342                    0.00               0.00  ...   
2343                    0.00               0.00  ...   

      Neighborhood_Northridge_Heights  Neighborhood_Northwest_Ames  \
0                                0.00                         0.00   
1                                1.00                         0.00   
2                                0.00                         0.00   
3                                0.00                         0.00   
4                                0.00                         1.00   
...                               ...                          ...   
2339                             0.00                         0.00   
2340                             1.00                         0.00   
2341                             0.00                         0.00   
2342                             0.00                         0.00   
2343                             0.00                         0.00   

      Neighborhood_Old_Town  Neighborhood_Sawyer  Neighborhood_Sawyer_West  \
0                      0.00                 0.00                      0.00   
1                      0.00                 0.00                      0.00   
2                      0.00                 0.00                      0.00   
3                      0.00                 0.00                      0.00   
4                      0.00                 0.00                      0.00   
...                     ...                  ...                       ...   
2339                   0.00                 0.00                      0.00   
2340                   0.00                 0.00                      0.00   
2341                   0.00                 0.00                      0.00   
2342                   0.00                 0.00                      0.00   
2343                   1.00                 0.00                      0.00   

      Neighborhood_Somerset  \
0                      1.00   
1                      0.00   
2                      0.00   
3                      0.00   
4                      0.00   
...                     ...   
2339                   0.00   
2340                   0.00   
2341                   0.00   
2342                   1.00   
2343                   0.00   

      Neighborhood_South_and_West_of_Iowa_State_University  \
0                                                  0.00      
1                                                  0.00      
2                                                  0.00      
3                                                  0.00      
4                                                  0.00      
...                                                 ...      
2339                                               0.00      
2340                                               0.00      
2341                                               0.00      
2342                                               0.00      
2343                                               0.00      

      Neighborhood_Stone_Brook  Neighborhood_Timberland  Neighborhood_Veenker  
0                         0.00                     0.00                  0.00  
1                         0.00                     0.00                  0.00  
2                         0.00                     0.00                  0.00  
3                         0.00                     0.00                  0.00  
4                         0.00                     0.00                  0.00  
...                        ...                      ...                   ...  
2339                      0.00                     0.00                  0.00  
2340                      0.00                     0.00                  0.00  
2341                      0.00                     0.00                  0.00  
2342                      0.00                     0.00                  0.00  
2343                      0.00                     0.00                  0.00  

[2344 rows x 41 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2344 entries, 0 to 2343
Data columns (total 41 columns):
 #   Column                                                Non-Null Count  Dtype  
---  ------                                                --------------  -----  
 0   Total_Bsmt_SF                                         2344 non-null   float64
 1   Gr_Liv_Area                                           2344 non-null   float64
 2   Year_Remod_Add                                        2344 non-null   float64
 3   First_Flr_SF                                          2344 non-null   float64
 4   Garage_Cars                                           2344 non-null   float64
 5   Full_Bath                                             2344 non-null   float64
 6   Overall_Cond_Average                                  2344 non-null   float64
 7   Overall_Cond_Below_Average                            2344 non-null   float64
 8   Overall_Cond_Excellent                                2344 non-null   float64
 9   Overall_Cond_Fair                                     2344 non-null   float64
 10  Overall_Cond_Good                                     2344 non-null   float64
 11  Overall_Cond_Poor                                     2344 non-null   float64
 12  Overall_Cond_Very_Good                                2344 non-null   float64
 13  Overall_Cond_Very_Poor                                2344 non-null   float64
 14  Neighborhood_Blueste                                  2344 non-null   float64
 15  Neighborhood_Briardale                                2344 non-null   float64
 16  Neighborhood_Brookside                                2344 non-null   float64
 17  Neighborhood_Clear_Creek                              2344 non-null   float64
 18  Neighborhood_College_Creek                            2344 non-null   float64
 19  Neighborhood_Crawford                                 2344 non-null   float64
 20  Neighborhood_Edwards                                  2344 non-null   float64
 21  Neighborhood_Gilbert                                  2344 non-null   float64
 22  Neighborhood_Green_Hills                              2344 non-null   float64
 23  Neighborhood_Greens                                   2344 non-null   float64
 24  Neighborhood_Iowa_DOT_and_Rail_Road                   2344 non-null   float64
 25  Neighborhood_Landmark                                 2344 non-null   float64
 26  Neighborhood_Meadow_Village                           2344 non-null   float64
 27  Neighborhood_Mitchell                                 2344 non-null   float64
 28  Neighborhood_North_Ames                               2344 non-null   float64
 29  Neighborhood_Northpark_Villa                          2344 non-null   float64
 30  Neighborhood_Northridge                               2344 non-null   float64
 31  Neighborhood_Northridge_Heights                       2344 non-null   float64
 32  Neighborhood_Northwest_Ames                           2344 non-null   float64
 33  Neighborhood_Old_Town                                 2344 non-null   float64
 34  Neighborhood_Sawyer                                   2344 non-null   float64
 35  Neighborhood_Sawyer_West                              2344 non-null   float64
 36  Neighborhood_Somerset                                 2344 non-null   float64
 37  Neighborhood_South_and_West_of_Iowa_State_University  2344 non-null   float64
 38  Neighborhood_Stone_Brook                              2344 non-null   float64
 39  Neighborhood_Timberland                               2344 non-null   float64
 40  Neighborhood_Veenker                                  2344 non-null   float64
dtypes: float64(41)
memory usage: 750.9 KB</code></pre>
</div>
</div>
</section>
<section id="análisis-del-efecto-de-la-fusión-de-categorías-de-las-casas-con-precios-más-altos." class="level3">
<h3 class="anchored" data-anchor-id="análisis-del-efecto-de-la-fusión-de-categorías-de-las-casas-con-precios-más-altos.">5.10 Análisis del efecto de la fusión de categorías de las casas con precios más altos.</h3>
<p>Mediante el siguiente código se fusionaron 7 categorías que contienen a las casas de mayor precio. La razón es que ahí se observa alta volatilidad en los precios.</p>
<p>La fusión se llevó a cabo definiendo una función que sumara los contenidos numéricos en la categoría Neighborhood_High_Price_Combined:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_columns(row):</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (row[<span class="st">'Neighborhood_Northridge'</span>] <span class="op">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Stone_Brook'</span>] <span class="op">+</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Northridge_Heights'</span>] <span class="op">+</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Green_Hills'</span>] <span class="op">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Veenker'</span>] <span class="op">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Timberland'</span>] <span class="op">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>          row[<span class="st">'Neighborhood_Somerset'</span>])</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>transformed_df[<span class="st">'Neighborhood_High_Price_Combined'</span>] <span class="op">=</span> transformed_df.<span class="bu">apply</span>(combine_columns, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> transformed_df.drop(columns<span class="op">=</span>[<span class="st">'Neighborhood_Northridge'</span>, <span class="st">'Neighborhood_Stone_Brook'</span>, <span class="st">'Neighborhood_Northridge_Heights'</span>, <span class="st">'Neighborhood_Green_Hills'</span>, <span class="st">'Neighborhood_Veenker'</span>, <span class="st">'Neighborhood_Timberland'</span>, <span class="st">'Neighborhood_Somerset'</span>])</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>transformed_df.info()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2344 entries, 0 to 2343
Data columns (total 35 columns):
 #   Column                                                Non-Null Count  Dtype  
---  ------                                                --------------  -----  
 0   Total_Bsmt_SF                                         2344 non-null   float64
 1   Gr_Liv_Area                                           2344 non-null   float64
 2   Year_Remod_Add                                        2344 non-null   float64
 3   First_Flr_SF                                          2344 non-null   float64
 4   Garage_Cars                                           2344 non-null   float64
 5   Full_Bath                                             2344 non-null   float64
 6   Overall_Cond_Average                                  2344 non-null   float64
 7   Overall_Cond_Below_Average                            2344 non-null   float64
 8   Overall_Cond_Excellent                                2344 non-null   float64
 9   Overall_Cond_Fair                                     2344 non-null   float64
 10  Overall_Cond_Good                                     2344 non-null   float64
 11  Overall_Cond_Poor                                     2344 non-null   float64
 12  Overall_Cond_Very_Good                                2344 non-null   float64
 13  Overall_Cond_Very_Poor                                2344 non-null   float64
 14  Neighborhood_Blueste                                  2344 non-null   float64
 15  Neighborhood_Briardale                                2344 non-null   float64
 16  Neighborhood_Brookside                                2344 non-null   float64
 17  Neighborhood_Clear_Creek                              2344 non-null   float64
 18  Neighborhood_College_Creek                            2344 non-null   float64
 19  Neighborhood_Crawford                                 2344 non-null   float64
 20  Neighborhood_Edwards                                  2344 non-null   float64
 21  Neighborhood_Gilbert                                  2344 non-null   float64
 22  Neighborhood_Greens                                   2344 non-null   float64
 23  Neighborhood_Iowa_DOT_and_Rail_Road                   2344 non-null   float64
 24  Neighborhood_Landmark                                 2344 non-null   float64
 25  Neighborhood_Meadow_Village                           2344 non-null   float64
 26  Neighborhood_Mitchell                                 2344 non-null   float64
 27  Neighborhood_North_Ames                               2344 non-null   float64
 28  Neighborhood_Northpark_Villa                          2344 non-null   float64
 29  Neighborhood_Northwest_Ames                           2344 non-null   float64
 30  Neighborhood_Old_Town                                 2344 non-null   float64
 31  Neighborhood_Sawyer                                   2344 non-null   float64
 32  Neighborhood_Sawyer_West                              2344 non-null   float64
 33  Neighborhood_South_and_West_of_Iowa_State_University  2344 non-null   float64
 34  Neighborhood_High_Price_Combined                      2344 non-null   float64
dtypes: float64(35)
memory usage: 641.1 KB</code></pre>
</div>
</div>
<p>Se eliminaron las columnas individuales a fin de evitar duplicidad.</p>
<p>Es importante destacar que la tabla de variables y coeficientes de regresión nos arrojaba previamente 41 variables, debido a la división de las categóricas, lo cual presentaba los siguientes aspectos a corregir:</p>
<ul>
<li><p>Exceso de variables.</p></li>
<li><p>En su mayoría presentan desviaciones estándar altas.</p></li>
<li><p>Siete variables presentan un P Value alto, lo que significa alta probabilidad de que el coeficiente sea cero.</p></li>
<li><p>Trece variables presentan alta volatilidad dada su desviación estándar e intervalo de confianza (pasa por el cero).</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imagenes/tabla%20de%20coeficientes.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Por lo anterior, se advirtió necesario fusionar a las variables para analizar el efecto predictivo del modelo dadas nuevas métricas resultantes de desempeño.</p>
<p>En especial fusionar Northridge, Northrige Heights y Stone Brook, donde se concentra el mayor número de propiedades con precios más altos que como se indicó en el punto 4.3.1, constituyen los datos atípicos en la variable a predecir.</p>
</section>
<section id="pipeline-y-modelado-con-fit-y-predict" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-y-modelado-con-fit-y-predict">5.11 Pipeline y modelado con fit y predict</h3>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, LinearRegression())</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline (le damos datos entrenamiento y datos a predecir)</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_train_selected, ames_y_train)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">'''results es un objeto que contiene toda la</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co">información de cómo se debe comportar el modelo'''</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'results es un objeto que contiene toda la\ninformación de cómo se debe comportar el modelo'</code></pre>
</div>
</div>
</section>
<section id="predicciones-y-coeficientes-de-regresión-1" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-y-coeficientes-de-regresión-1">5.12 Predicciones y coeficientes de regresión</h3>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>y_pred</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> ames_y_test)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#ames_test.info()</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">Sale_Price_Pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>156422.38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>127606.36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>97322.64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>203135.18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>244038.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>168262.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>119918.54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>205732.84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>107382.37</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>104820.55</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>X_train_with_intercept <span class="op">=</span> sm.add_constant(transformed_df)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, X_train_with_intercept).fit()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>y</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.804</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.801</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>270.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Wed, 15 Nov 2023</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>16:16:23</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-27865.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>2344</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>5.580e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>2308</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>5.601e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>35</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>1.803e+05</td>
<td>7956.508</td>
<td>22.657</td>
<td>0.000</td>
<td>1.65e+05</td>
<td>1.96e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total_Bsmt_SF</td>
<td>2.129e+04</td>
<td>1528.601</td>
<td>13.926</td>
<td>0.000</td>
<td>1.83e+04</td>
<td>2.43e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gr_Liv_Area</td>
<td>4.033e+04</td>
<td>1397.071</td>
<td>28.868</td>
<td>0.000</td>
<td>3.76e+04</td>
<td>4.31e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Year_Remod_Add</td>
<td>1.297e+04</td>
<td>1957.905</td>
<td>6.626</td>
<td>0.000</td>
<td>9134.334</td>
<td>1.68e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">First_Flr_SF</td>
<td>3438.8088</td>
<td>1831.594</td>
<td>1.877</td>
<td>0.061</td>
<td>-152.933</td>
<td>7030.551</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Garage_Cars</td>
<td>1.544e+04</td>
<td>1335.699</td>
<td>11.562</td>
<td>0.000</td>
<td>1.28e+04</td>
<td>1.81e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Full_Bath</td>
<td>-8147.7442</td>
<td>1997.449</td>
<td>-4.079</td>
<td>0.000</td>
<td>-1.21e+04</td>
<td>-4230.762</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Overall_Cond_Average</td>
<td>-3413.6342</td>
<td>2240.301</td>
<td>-1.524</td>
<td>0.128</td>
<td>-7806.847</td>
<td>979.579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Overall_Cond_Below_Average</td>
<td>-2.213e+04</td>
<td>4379.875</td>
<td>-5.053</td>
<td>0.000</td>
<td>-3.07e+04</td>
<td>-1.35e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Overall_Cond_Excellent</td>
<td>2.271e+04</td>
<td>6620.424</td>
<td>3.430</td>
<td>0.001</td>
<td>9724.642</td>
<td>3.57e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Overall_Cond_Fair</td>
<td>-2.961e+04</td>
<td>5710.093</td>
<td>-5.185</td>
<td>0.000</td>
<td>-4.08e+04</td>
<td>-1.84e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Overall_Cond_Good</td>
<td>6867.1005</td>
<td>2736.058</td>
<td>2.510</td>
<td>0.012</td>
<td>1501.711</td>
<td>1.22e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Overall_Cond_Poor</td>
<td>-4.888e+04</td>
<td>1.2e+04</td>
<td>-4.060</td>
<td>0.000</td>
<td>-7.25e+04</td>
<td>-2.53e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Overall_Cond_Very_Good</td>
<td>7846.6858</td>
<td>3944.868</td>
<td>1.989</td>
<td>0.047</td>
<td>110.831</td>
<td>1.56e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Overall_Cond_Very_Poor</td>
<td>-5.149e+04</td>
<td>1.48e+04</td>
<td>-3.483</td>
<td>0.001</td>
<td>-8.05e+04</td>
<td>-2.25e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Blueste</td>
<td>-5995.7964</td>
<td>1.49e+04</td>
<td>-0.402</td>
<td>0.688</td>
<td>-3.53e+04</td>
<td>2.33e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Briardale</td>
<td>-1.479e+04</td>
<td>1.1e+04</td>
<td>-1.348</td>
<td>0.178</td>
<td>-3.63e+04</td>
<td>6718.091</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Brookside</td>
<td>-1.961e+04</td>
<td>9005.278</td>
<td>-2.177</td>
<td>0.030</td>
<td>-3.73e+04</td>
<td>-1947.504</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Clear_Creek</td>
<td>4566.2801</td>
<td>9732.489</td>
<td>0.469</td>
<td>0.639</td>
<td>-1.45e+04</td>
<td>2.37e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_College_Creek</td>
<td>7085.1305</td>
<td>7990.097</td>
<td>0.887</td>
<td>0.375</td>
<td>-8583.388</td>
<td>2.28e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Crawford</td>
<td>5108.9878</td>
<td>8886.161</td>
<td>0.575</td>
<td>0.565</td>
<td>-1.23e+04</td>
<td>2.25e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Edwards</td>
<td>-1.85e+04</td>
<td>8476.047</td>
<td>-2.182</td>
<td>0.029</td>
<td>-3.51e+04</td>
<td>-1877.130</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Gilbert</td>
<td>5124.1532</td>
<td>8276.118</td>
<td>0.619</td>
<td>0.536</td>
<td>-1.11e+04</td>
<td>2.14e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Greens</td>
<td>2.302e+04</td>
<td>1.64e+04</td>
<td>1.399</td>
<td>0.162</td>
<td>-9235.711</td>
<td>5.53e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Iowa_DOT_and_Rail_Road</td>
<td>-2.547e+04</td>
<td>9154.442</td>
<td>-2.783</td>
<td>0.005</td>
<td>-4.34e+04</td>
<td>-7522.231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Landmark</td>
<td>-1.438e+04</td>
<td>3.63e+04</td>
<td>-0.396</td>
<td>0.692</td>
<td>-8.56e+04</td>
<td>5.69e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Meadow_Village</td>
<td>-1.856e+04</td>
<td>1.04e+04</td>
<td>-1.776</td>
<td>0.076</td>
<td>-3.9e+04</td>
<td>1931.735</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Mitchell</td>
<td>-1.448e+04</td>
<td>8578.257</td>
<td>-1.688</td>
<td>0.092</td>
<td>-3.13e+04</td>
<td>2343.016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_North_Ames</td>
<td>-1.861e+04</td>
<td>8164.916</td>
<td>-2.279</td>
<td>0.023</td>
<td>-3.46e+04</td>
<td>-2596.646</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Northpark_Villa</td>
<td>-1.067e+04</td>
<td>1.19e+04</td>
<td>-0.899</td>
<td>0.369</td>
<td>-3.39e+04</td>
<td>1.26e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Northwest_Ames</td>
<td>-1.446e+04</td>
<td>8540.359</td>
<td>-1.693</td>
<td>0.091</td>
<td>-3.12e+04</td>
<td>2286.967</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Old_Town</td>
<td>-3.669e+04</td>
<td>8469.073</td>
<td>-4.332</td>
<td>0.000</td>
<td>-5.33e+04</td>
<td>-2.01e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_Sawyer</td>
<td>-1.494e+04</td>
<td>8513.188</td>
<td>-1.755</td>
<td>0.079</td>
<td>-3.16e+04</td>
<td>1750.718</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_Sawyer_West</td>
<td>-5127.7219</td>
<td>8503.443</td>
<td>-0.603</td>
<td>0.547</td>
<td>-2.18e+04</td>
<td>1.15e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Neighborhood_South_and_West_of_Iowa_State_University</td>
<td>-2.472e+04</td>
<td>9994.923</td>
<td>-2.474</td>
<td>0.013</td>
<td>-4.43e+04</td>
<td>-5124.957</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neighborhood_High_Price_Combined</td>
<td>4.544e+04</td>
<td>7808.265</td>
<td>5.820</td>
<td>0.000</td>
<td>3.01e+04</td>
<td>6.08e+04</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>588.786</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>1.973</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>34853.161</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>0.203</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>21.886</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>75.5</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
</section>
<section id="métricas-de-desempeño-con-variables-fusionadas" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-con-variables-fusionadas">5.13 Métricas de desempeño con variables fusionadas</h3>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">35</span>  <span class="co"># Número de predictores </span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>],</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>791.64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>23317.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>1540507564.43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>39249.30</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.75</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gráficos-de-desempeño-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="gráficos-de-desempeño-del-modelo">5.14 Gráficos de desempeño del modelo</h3>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price_Pred"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">500000</span>] ) <span class="op">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 2 rows containing missing values.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-51-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 97'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-52-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="validación-cruzada" class="level2">
<h2 class="anchored" data-anchor-id="validación-cruzada"><strong>6. Validación cruzada</strong></h2>
<section id="definición-del-objeto-k-fold-cv-y-las-métricas-de-desempeño" class="level3">
<h3 class="anchored" data-anchor-id="definición-del-objeto-k-fold-cv-y-las-métricas-de-desempeño">6.1 Definición del objeto K-Fold CV y las métricas de desempeño</h3>
<p>Con la finalidad de evaluar el rendimiento del modelo, utilizamos la técnica K-Fold Cross Validator con un KFold = 10.</p>
<p>La validación cruzada proporciona una estimación más precisa del rendimiento del modelo al promediar sobre múltiples particiones del conjunto de datos.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el objeto K-Fold Cross Validator</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)  <span class="co"># La semilla permite replicar resultados aleatorios</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir las métricas de desempeño que deseas calcular como funciones de puntuación</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="realización-de-validación-cruzada-y-cálculo-de-estadísticas" class="level3">
<h3 class="anchored" data-anchor-id="realización-de-validación-cruzada-y-cálculo-de-estadísticas">6.2 Realización de validación cruzada y cálculo de estadísticas</h3>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizar la validación cruzada y calcular métricas de desempeño utilizando cross_val_score</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> cross_validate(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  pipeline, </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  ames_train_selected, ames_y_train,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  cv<span class="op">=</span>kf, </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  scoring<span class="op">=</span>scoring</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular estadísticas resumidas (media y desviación estándar) de las métricas</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>mean_rmse <span class="op">=</span> np.mean(np.sqrt(<span class="op">-</span>results[<span class="st">'test_neg_mean_squared_error'</span>]))</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>std_rmse <span class="op">=</span> np.std(np.sqrt(<span class="op">-</span>results[<span class="st">'test_neg_mean_squared_error'</span>]))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>mean_r2 <span class="op">=</span> np.mean(results[<span class="st">'test_r2'</span>])</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>std_r2 <span class="op">=</span> np.std(results[<span class="st">'test_r2'</span>])</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>mean_mae <span class="op">=</span> np.mean(<span class="op">-</span>results[<span class="st">'test_neg_mean_absolute_error'</span>])</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>std_mae <span class="op">=</span> np.std(<span class="op">-</span>results[<span class="st">'test_neg_mean_absolute_error'</span>])</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>mean_mape <span class="op">=</span> np.mean(<span class="op">-</span>results[<span class="st">'test_mape'</span>])</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>std_mape <span class="op">=</span> np.std(<span class="op">-</span>results[<span class="st">'test_mape'</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [1] during transform. These unknown categories will be encoded as all zeros
C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [1] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
</div>
</section>
<section id="resultados" class="level3">
<h3 class="anchored" data-anchor-id="resultados">6.3 Resultados</h3>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAE: </span><span class="sc">{</span>mean_mae<span class="sc">}</span><span class="ss"> +/- </span><span class="sc">{</span>std_mae<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"MAPE: </span><span class="sc">{</span>mean_mape<span class="sc">}</span><span class="ss"> +/- </span><span class="sc">{</span>std_mape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R^2: </span><span class="sc">{</span>mean_r2<span class="sc">}</span><span class="ss"> +/- </span><span class="sc">{</span>std_r2<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>mean_rmse<span class="sc">}</span><span class="ss"> +/- </span><span class="sc">{</span>std_rmse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MAE: 22496.24418989381 +/- 1000.5726811589326
MAPE: 0.1348217244128888 +/- 0.008755194294539926
R^2: 0.8098793854214945 +/- 0.037187507852489185
RMSE: 34470.878997869 +/- 4028.395500622089</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusiones-modelo-de-regresión-lineal" class="level2">
<h2 class="anchored" data-anchor-id="conclusiones-modelo-de-regresión-lineal"><strong>7. Conclusiones Modelo de regresión lineal</strong></h2>
<p>Se utilizaron dos modelos de regresión lineal, siendo éste último reducido a 35 subcategorías el que demostró un rendimiento mejor.</p>
<p>Este modelo alcanza a tener un desempeño de 0.81, teniendo pendientes los siguientes ajustes y correcciones:</p>
<ul>
<li><p>La selección de dos variables categóricas ocasiona que tengamos 41 categorías o predictores, mismos que redujimos a 35 con la finalidad de mitigar un poco la alta volatilidad y mejorar la capacidad predictora del modelo.</p></li>
<li><p>Lo anterior debido a que el cuadro detalle de regresión pone en evidencia categorías con desviación estándar alta, <em>P Value</em> y un intervalo de confianza que confirman una alta volatilidad que afecta negativamente la capácidad predictora del modelo.</p></li>
<li><p>Los gráficos de desempéño muestran alta volatilidad en particular en las casas de precios superiores.</p></li>
</ul>
</section>
<section id="k-nearest-neighbor" class="level2">
<h2 class="anchored" data-anchor-id="k-nearest-neighbor"><strong>8. K Nearest Neighbor</strong></h2>
<p>Mediante el procedimiento de K vecinos más cercanos pretendemos mejorar el poder de predicción.</p>
<section id="pipeline-y-modelado" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-y-modelado">8.1 Pipeline y modelado</h3>
<p>Se lleva a cabo la selección del modelo con el hiper-parámetro de 10 vecinos cercanos por considerarse un equilibrio adecuado entre varianza y sesgo.</p>
<p>Es importante considerar la máxima de que en KNN, la decisión del hiper-parámetro <em>k</em> (número de vecinos) se toma con base en los datos de prueba, no los de entrenamiento. A diferencia de un modelo de regresión lineal, en donde los coeficientes se toman en cuenta basados en los datos de entrenamiento.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el pipeline con la regresión lineal</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline con los datos de entrenamiento y su variable</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_train_selected, ames_y_train)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predicciones" class="level3">
<h3 class="anchored" data-anchor-id="predicciones">8.2 Predicciones</h3>
<p>Almacenamos en el vector <em>y_pred</em> los datos de predicción.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> ames_y_test)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>ames_test.info()</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos predicción y observación:</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 586 entries, 390 to 714
Data columns (total 75 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   MS_SubClass         586 non-null    object 
 1   MS_Zoning           586 non-null    object 
 2   Lot_Frontage        586 non-null    int64  
 3   Lot_Area            586 non-null    int64  
 4   Street              586 non-null    object 
 5   Alley               586 non-null    object 
 6   Lot_Shape           586 non-null    object 
 7   Land_Contour        586 non-null    object 
 8   Utilities           586 non-null    object 
 9   Lot_Config          586 non-null    object 
 10  Land_Slope          586 non-null    object 
 11  Neighborhood        586 non-null    object 
 12  Condition_1         586 non-null    object 
 13  Condition_2         586 non-null    object 
 14  Bldg_Type           586 non-null    object 
 15  House_Style         586 non-null    object 
 16  Overall_Cond        586 non-null    object 
 17  Year_Built          586 non-null    int64  
 18  Year_Remod_Add      586 non-null    int64  
 19  Roof_Style          586 non-null    object 
 20  Roof_Matl           586 non-null    object 
 21  Exterior_1st        586 non-null    object 
 22  Exterior_2nd        586 non-null    object 
 23  Mas_Vnr_Type        220 non-null    object 
 24  Mas_Vnr_Area        586 non-null    int64  
 25  Exter_Cond          586 non-null    object 
 26  Foundation          586 non-null    object 
 27  Bsmt_Cond           586 non-null    object 
 28  Bsmt_Exposure       586 non-null    object 
 29  BsmtFin_Type_1      586 non-null    object 
 30  BsmtFin_SF_1        586 non-null    int64  
 31  BsmtFin_Type_2      586 non-null    object 
 32  BsmtFin_SF_2        586 non-null    int64  
 33  Bsmt_Unf_SF         586 non-null    int64  
 34  Total_Bsmt_SF       586 non-null    int64  
 35  Heating             586 non-null    object 
 36  Heating_QC          586 non-null    object 
 37  Central_Air         586 non-null    object 
 38  Electrical          586 non-null    object 
 39  First_Flr_SF        586 non-null    int64  
 40  Second_Flr_SF       586 non-null    int64  
 41  Gr_Liv_Area         586 non-null    int64  
 42  Bsmt_Full_Bath      586 non-null    int64  
 43  Bsmt_Half_Bath      586 non-null    int64  
 44  Full_Bath           586 non-null    int64  
 45  Half_Bath           586 non-null    int64  
 46  Bedroom_AbvGr       586 non-null    int64  
 47  Kitchen_AbvGr       586 non-null    int64  
 48  TotRms_AbvGrd       586 non-null    int64  
 49  Functional          586 non-null    object 
 50  Fireplaces          586 non-null    int64  
 51  Garage_Type         586 non-null    object 
 52  Garage_Finish       586 non-null    object 
 53  Garage_Cars         586 non-null    int64  
 54  Garage_Area         586 non-null    int64  
 55  Garage_Cond         586 non-null    object 
 56  Paved_Drive         586 non-null    object 
 57  Wood_Deck_SF        586 non-null    int64  
 58  Open_Porch_SF       586 non-null    int64  
 59  Enclosed_Porch      586 non-null    int64  
 60  Three_season_porch  586 non-null    int64  
 61  Screen_Porch        586 non-null    int64  
 62  Pool_Area           586 non-null    int64  
 63  Pool_QC             586 non-null    object 
 64  Fence               586 non-null    object 
 65  Misc_Feature        27 non-null     object 
 66  Misc_Val            586 non-null    int64  
 67  Mo_Sold             586 non-null    int64  
 68  Year_Sold           586 non-null    int64  
 69  Sale_Type           586 non-null    object 
 70  Sale_Condition      586 non-null    object 
 71  Longitude           586 non-null    float64
 72  Latitude            586 non-null    float64
 73  Sale_Price_Pred     586 non-null    float64
 74  Sale_Price          586 non-null    int64  
dtypes: float64(3), int64(32), object(40)
memory usage: 347.9+ KB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">Sale_Price_Pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>160790.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>133943.80</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>90225.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>174600.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>256250.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>164500.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>124800.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>157180.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>114620.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>112640.00</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="métricas-de-desempeño" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño">8.3 Métricas de desempeño</h3>
<p>Añadimos la métrica RMSLE significa “Root Mean Squared Logarithmic Error” (Error Cuadrático Logarítmico Medio) buscando en ésta un resultado lo más cercano a cero posible.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>rmsle <span class="op">=</span> np.sqrt(np.mean((np.log(y_pred <span class="op">+</span> <span class="dv">1</span>) <span class="op">-</span> np.log(y_obs <span class="op">+</span> <span class="dv">1</span>))<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">35</span>  <span class="co"># Número de predictores </span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>, <span class="st">"RMSLE"</span>],</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj, rmsle]</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>1734.69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>19651.39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>973724957.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>31204.57</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.85</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>RMSLE</td>
<td>0.16</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gráficos-de-desempeño-del-modelo-1" class="level3">
<h3 class="anchored" data-anchor-id="gráficos-de-desempeño-del-modelo-1">8.4 Gráficos de desempeño del modelo</h3>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>, y <span class="op">=</span> <span class="st">"Sale_Price_Pred"</span>)) <span class="op">+</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">500000</span>] ) <span class="op">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 3 rows containing missing values.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-61-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 73'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-62-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="validación-cruzada-1" class="level2">
<h2 class="anchored" data-anchor-id="validación-cruzada-1"><strong>9. Validación cruzada</strong></h2>
<p>Se define un K = 10, por regla general. Vecinos cercanos en un rango de 7 a 31, ya que en gráfico más adelante se aprecia que a partir de 19 vecinos cercanos la <em>R2</em> cae de forma constante hasta 60 vecinos.</p>
<p>**Es necesario definir la línea de código metric’ con ‘p’: [1, 2] para evitar el *AttributeError: ‘DataFrame’ object has no attribute ‘param_p’**</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el objeto K-Fold Cross Validator</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span>k, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co"># grid o rejilla de parametrización</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co">#param_grid = {</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 'n_neighbors': range(7, 32),</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 'weights': ['uniform', 'distance'],  # uniforme y ponderada por distancia</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 'metric': ['euclidean', 'manhattan'], 'p': [1, 2]</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">7</span>, <span class="dv">32</span>),</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],  <span class="co"># uniforme y ponderada por distancia</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'chebyshev'</span>], <span class="st">'p'</span>: [<span class="dv">1</span>, <span class="dv">2</span>]}</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># AttributeError: 'DataFrame' object has no attribute 'param_p'</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se establecen las métricas de desempeño como funciones de puntuación</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjusted_r2_score(y_true, y_pred, n, p):</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  adjusted_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r2) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> adjusted_r2</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos el diccionario con las métricas que nos interesan:</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>                      greater_is_better<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>                      n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_train_selected)), </span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>                      p<span class="op">=</span><span class="bu">len</span>(ames_train_selected.columns)),</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Pipeline con el preprocesamiento (FE), el regresor de vecinos cercanos, la rejilla de parametrización</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a><span class="co"># el KF Cross Validation, las métricas definidas en scoring</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a><span class="co"># el reajuste con determinada parametrización, </span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a><span class="co"># la información del proceso (verbose)</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a><span class="co"># n_jobs para aprovechar al máximo la capacidad de la computadora (4 núcleos, 8 procesadores lógicos)</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'regressor'</span>, GridSearchCV(</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilizamos los datos de entrenamiento</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a>pipeline.fit(ames_train_selected, ames_y_train)</span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a><span class="co"># El atributo cv_results da los resultados de cada fold, de cada métrica, de cada hiper-parámetro.</span></span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a>results_cv <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].cv_results_</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 10 folds for each of 300 candidates, totalling 3000 fits</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convierte los resultados en un DataFrame</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">500</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame(results_cv)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>results_df.columns</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>Index(['mean_fit_time', 'std_fit_time', 'mean_score_time', 'std_score_time',
       'param_metric', 'param_n_neighbors', 'param_p', 'param_weights',
       'params', 'split0_test_neg_mean_squared_error',
       'split1_test_neg_mean_squared_error',
       'split2_test_neg_mean_squared_error',
       'split3_test_neg_mean_squared_error',
       'split4_test_neg_mean_squared_error',
       'split5_test_neg_mean_squared_error',
       'split6_test_neg_mean_squared_error',
       'split7_test_neg_mean_squared_error',
       'split8_test_neg_mean_squared_error',
       'split9_test_neg_mean_squared_error',
       'mean_test_neg_mean_squared_error', 'std_test_neg_mean_squared_error',
       'rank_test_neg_mean_squared_error', 'split0_test_r2', 'split1_test_r2',
       'split2_test_r2', 'split3_test_r2', 'split4_test_r2', 'split5_test_r2',
       'split6_test_r2', 'split7_test_r2', 'split8_test_r2', 'split9_test_r2',
       'mean_test_r2', 'std_test_r2', 'rank_test_r2',
       'split0_test_neg_mean_absolute_error',
       'split1_test_neg_mean_absolute_error',
       'split2_test_neg_mean_absolute_error',
       'split3_test_neg_mean_absolute_error',
       'split4_test_neg_mean_absolute_error',
       'split5_test_neg_mean_absolute_error',
       'split6_test_neg_mean_absolute_error',
       'split7_test_neg_mean_absolute_error',
       'split8_test_neg_mean_absolute_error',
       'split9_test_neg_mean_absolute_error',
       'mean_test_neg_mean_absolute_error', 'std_test_neg_mean_absolute_error',
       'rank_test_neg_mean_absolute_error', 'split0_test_mape',
       'split1_test_mape', 'split2_test_mape', 'split3_test_mape',
       'split4_test_mape', 'split5_test_mape', 'split6_test_mape',
       'split7_test_mape', 'split8_test_mape', 'split9_test_mape',
       'mean_test_mape', 'std_test_mape', 'rank_test_mape'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedes seleccionar las columnas de interés, quitamos splits, tiempos y 'params' a fin de ver un resumen más claro:</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> (</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  results_df <span class="op">&gt;&gt;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  select(<span class="op">-</span>_.contains(<span class="st">"split"</span>), <span class="op">-</span>_.contains(<span class="st">"time"</span>), <span class="op">-</span>_.params)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>summary_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">param_metric</th>
<th data-quarto-table-cell-role="th">param_n_neighbors</th>
<th data-quarto-table-cell-role="th">param_p</th>
<th data-quarto-table-cell-role="th">param_weights</th>
<th data-quarto-table-cell-role="th">mean_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">std_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">rank_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">mean_test_r2</th>
<th data-quarto-table-cell-role="th">std_test_r2</th>
<th data-quarto-table-cell-role="th">rank_test_r2</th>
<th data-quarto-table-cell-role="th">mean_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">std_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">rank_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">mean_test_mape</th>
<th data-quarto-table-cell-role="th">std_test_mape</th>
<th data-quarto-table-cell-role="th">rank_test_mape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>euclidean</td>
<td>7</td>
<td>1</td>
<td>uniform</td>
<td>-1091811296.29</td>
<td>264530802.16</td>
<td>155</td>
<td>0.82</td>
<td>0.05</td>
<td>157</td>
<td>-21015.87</td>
<td>1415.32</td>
<td>149</td>
<td>-0.13</td>
<td>0.01</td>
<td>141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>euclidean</td>
<td>7</td>
<td>1</td>
<td>distance</td>
<td>-1048034511.33</td>
<td>222745978.96</td>
<td>99</td>
<td>0.83</td>
<td>0.05</td>
<td>111</td>
<td>-20565.00</td>
<td>1020.96</td>
<td>99</td>
<td>-0.13</td>
<td>0.01</td>
<td>91</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>euclidean</td>
<td>7</td>
<td>2</td>
<td>uniform</td>
<td>-1091811296.29</td>
<td>264530802.16</td>
<td>155</td>
<td>0.82</td>
<td>0.05</td>
<td>157</td>
<td>-21015.87</td>
<td>1415.32</td>
<td>149</td>
<td>-0.13</td>
<td>0.01</td>
<td>141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>euclidean</td>
<td>7</td>
<td>2</td>
<td>distance</td>
<td>-1048034511.33</td>
<td>222745978.96</td>
<td>99</td>
<td>0.83</td>
<td>0.05</td>
<td>111</td>
<td>-20565.00</td>
<td>1020.96</td>
<td>99</td>
<td>-0.13</td>
<td>0.01</td>
<td>91</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>euclidean</td>
<td>8</td>
<td>1</td>
<td>uniform</td>
<td>-1088841670.59</td>
<td>267526880.99</td>
<td>149</td>
<td>0.83</td>
<td>0.05</td>
<td>151</td>
<td>-20947.13</td>
<td>1498.63</td>
<td>143</td>
<td>-0.13</td>
<td>0.01</td>
<td>139</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">295</td>
<td>chebyshev</td>
<td>30</td>
<td>2</td>
<td>distance</td>
<td>-1386048073.14</td>
<td>245251083.59</td>
<td>233</td>
<td>0.78</td>
<td>0.03</td>
<td>223</td>
<td>-23879.93</td>
<td>1073.92</td>
<td>231</td>
<td>-0.15</td>
<td>0.02</td>
<td>239</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">296</td>
<td>chebyshev</td>
<td>31</td>
<td>1</td>
<td>uniform</td>
<td>-1571167305.28</td>
<td>289245372.59</td>
<td>299</td>
<td>0.75</td>
<td>0.04</td>
<td>299</td>
<td>-26225.46</td>
<td>1320.89</td>
<td>295</td>
<td>-0.17</td>
<td>0.02</td>
<td>291</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">297</td>
<td>chebyshev</td>
<td>31</td>
<td>1</td>
<td>distance</td>
<td>-1396635370.34</td>
<td>251001322.37</td>
<td>249</td>
<td>0.78</td>
<td>0.03</td>
<td>243</td>
<td>-23920.98</td>
<td>1093.88</td>
<td>241</td>
<td>-0.16</td>
<td>0.02</td>
<td>245</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">298</td>
<td>chebyshev</td>
<td>31</td>
<td>2</td>
<td>uniform</td>
<td>-1571167305.28</td>
<td>289245372.59</td>
<td>299</td>
<td>0.75</td>
<td>0.04</td>
<td>299</td>
<td>-26225.46</td>
<td>1320.89</td>
<td>295</td>
<td>-0.17</td>
<td>0.02</td>
<td>291</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">299</td>
<td>chebyshev</td>
<td>31</td>
<td>2</td>
<td>distance</td>
<td>-1396635370.34</td>
<td>251001322.37</td>
<td>249</td>
<td>0.78</td>
<td>0.03</td>
<td>243</td>
<td>-23920.98</td>
<td>1093.88</td>
<td>241</td>
<td>-0.16</td>
<td>0.02</td>
<td>245</td>
</tr>
</tbody>
</table>

<p>300 rows × 16 columns</p>
</div>
</div>
</div>
<p>El siguiente gráfico muestra un resumen del desempeño de todas las combinaciones posibles de modelos. Se concluye que la <em>R2</em> óptima se obtiene con el parámetro de medición manhattan, y ponderación mediante la distancia.</p>
<p>La mejor medición mediante inspección visual: 14 vecinos cercanos.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="op">&gt;&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, size <span class="op">=</span> <span class="st">"param_p"</span>,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>             color <span class="op">=</span> <span class="st">"param_metric"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>)) <span class="op">+</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\scales\scale_size.py:49: PlotnineWarning: Using size for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>En el siguiente gráfico vemos cómo la volatilidad se incrementa a partir de manera constante a partir del vecino 14, aunque también disminuye un poco el intervalo.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="op">&gt;&gt;</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">filter</span>(</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    _.param_weights <span class="op">==</span> <span class="st">"uniform"</span>,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>    _.param_p <span class="op">==</span> <span class="dv">1</span>,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    _.param_metric <span class="op">==</span> <span class="st">"manhattan"</span>) <span class="op">&gt;&gt;</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> np.maximum(<span class="dv">0</span>, _.mean_test_r2 <span class="op">-</span> _.std_test_r2),</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> np.minimum(<span class="dv">1</span>, _.mean_test_r2 <span class="op">+</span> _.std_test_r2)) <span class="op">&gt;&gt;</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>)) <span class="op">+</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.3</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>)</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-70-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>A continuación utilizamos el atributo best_params_ que nos permite saber cuál es la mejor parametrización.</p>
<p>[‘Manhattan, 9 vecinos, peso uniforme’]</p>
<p>De este modo, se observa que la apreciación visual nos da a 14 como mejor vecino, sin embargo la medición precisa del mejor hiper-parámetro nos indica que son 9 los vecinos cercanos.</p>
<p>La utilización del mejor estimador una vez aplicado el refit, confirma que la <em>R2</em> óptima se obtiene con el parámetro de medición manhattan, y ponderación mediante la distancia.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].best_params_</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'*'</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_params)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>best_estimator <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].best_estimator_</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'*'</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_estimator)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************
{'metric': 'manhattan', 'n_neighbors': 9, 'p': 1, 'weights': 'distance'}
************************************************************
KNeighborsRegressor(metric='manhattan', n_neighbors=9, p=1, weights='distance')</code></pre>
</div>
</div>
<section id="predicciones-finales" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-finales">9.1 Predicciones finales</h3>
<p>A continuación, se utiliza al mejor estimador obteniendo el modelo que mejor desempeño tiene.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>final_knn_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, best_estimator)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>final_knn_pipeline.fit(ames_train_selected, ames_y_train)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Predicciones finales</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>y_pred_knn <span class="op">=</span> final_knn_pipeline.predict(ames_x_test)</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>results_reg <span class="op">=</span> (</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>  mutate(final_knn_pred <span class="op">=</span> y_pred_knn, Sale_Price <span class="op">=</span> ames_y_test) <span class="op">&gt;&gt;</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.final_knn_pred)</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>results_reg</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">final_knn_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>159503.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>138968.43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>79275.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>183261.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>225643.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>163258.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>76500.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>151324.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>115699.22</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>112194.67</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="métricas-de-desempeño-1" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-1">9.2 Métricas de desempeño</h3>
<p>Las métricas de desempeño con este mejor modelo nos arrojan un 87% de precisión. Una media del error absoluto en porcentaje (MAPE) del 11%.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred_knn)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred_knn)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred_knn)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred_knn)</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred_knn)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> adjusted_r2_score(y_true <span class="op">=</span> y_obs, y_pred <span class="op">=</span> y_pred_knn,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_train_selected)), p<span class="op">=</span><span class="bu">len</span>(ames_train_selected.columns))</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>],</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>2577.14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>18915.46</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>885780685.49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>29762.07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.87</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.86</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  results_reg <span class="op">&gt;&gt;</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"final_knn_pred"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    xlab(<span class="st">"Prediction"</span>) <span class="op">+</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    ylab(<span class="st">"Observation"</span>) <span class="op">+</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    ggtitle(<span class="st">"Comparisson"</span>)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-74-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="importancia-de-variables" class="level3">
<h3 class="anchored" data-anchor-id="importancia-de-variables">9.3 Importancia de variables</h3>
<p>Tratamos de responder a la pregunta: ¿Cuáles fueron las variables que tuvieron mayor importancia para el fenómeno?</p>
<p>En términos generales, podemos decir que removiendo una variable, vemos el impacto de su ausencia, y por ende, su importancia.</p>
<p>Esto en el procedimiento y su código se traduce en una permutación.</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 permutación</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector de importancias:</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> np.zeros(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>])</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Realiza el procedimiento de permutación. Utiliza un iterador.</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>]):</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>    ames_x_test_permuted <span class="op">=</span> ames_x_test[columnas_seleccionadas].copy()</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>    ames_x_test_permuted.iloc[:, i] <span class="op">=</span> shuffle(ames_x_test_permuted.iloc[:, i], random_state<span class="op">=</span><span class="dv">42</span>)  </span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Permuta una característica</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>    y_pred_permuted <span class="op">=</span> final_knn_pipeline.predict(ames_x_test_permuted)</span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    mse_permuted <span class="op">=</span> mean_squared_error(ames_y_test, y_pred_permuted)</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    importance[i] <span class="op">=</span> mse <span class="op">-</span> mse_permuted</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula la importancia relativa</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> importance <span class="op">/</span> importance.<span class="bu">sum</span>()</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'*'</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(importance)</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: columnas_seleccionadas, </span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Importance'</span>: importance</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************
[0.10792925 0.33891192 0.04296171 0.09891188 0.13125641 0.00445849
 0.02234291 0.25322744]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x<span class="op">=</span> <span class="st">'reorder(Variable, Importance)'</span>, y<span class="op">=</span><span class="st">'Importance'</span>)) <span class="op">+</span> </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  geom_bar(stat<span class="op">=</span><span class="st">'identity'</span>, fill<span class="op">=</span><span class="st">'blue'</span>, color <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span> </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>A continuación utilizaremos 100 permutaciones para asegurarnos de tener una mayor precisión en la determinación de la importancia de las variables.</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># N permutaciones</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>n_permutations <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>performance_losses <span class="op">=</span> []</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>]):</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> []</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_permutations):</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>        ames_x_test_permuted <span class="op">=</span> ames_x_test[columnas_seleccionadas].copy()</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>        ames_x_test_permuted.iloc[:, i] <span class="op">=</span> np.random.permutation(ames_x_test_permuted.iloc[:, i])</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>        y_pred_permuted <span class="op">=</span> final_knn_pipeline.predict(ames_x_test_permuted)</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>        mse_permuted <span class="op">=</span> mean_squared_error(ames_y_test, y_pred_permuted)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>        loss.append(mse_permuted)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>    performance_losses.append(loss)</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>performance_losses <span class="op">=</span> performance_losses<span class="op">/</span>np.<span class="bu">sum</span>(performance_losses, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>mean_losses <span class="op">=</span> np.mean(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>std_losses <span class="op">=</span> np.std(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: columnas_seleccionadas, </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Mean_Loss'</span>: mean_losses, </span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Std_Loss'</span>: std_losses</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(importance_df)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Variable  Mean_Loss  Std_Loss
0   Total_Bsmt_SF       0.12      0.00
1     Gr_Liv_Area       0.18      0.01
2  Year_Remod_Add       0.10      0.00
3    First_Flr_SF       0.12      0.00
4     Garage_Cars       0.13      0.00
5       Full_Bath       0.09      0.00
6    Overall_Cond       0.10      0.00
7    Neighborhood       0.16      0.01</code></pre>
</div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-78-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest"><strong>10. Random Forest</strong></h2>
<section id="pipeline-y-modelado-1" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-y-modelado-1">10.1 Pipeline y modelado</h3>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el pipeline con la regresión por Random Forest</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, RandomForestRegressor(</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>     n_estimators<span class="op">=</span><span class="dv">100</span>,  <span class="co"># Árboles a introducir</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>     max_depth <span class="op">=</span> <span class="dv">7</span>,  <span class="co"># Niveles - profundidad del árbol</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>     min_samples_split<span class="op">=</span><span class="dv">10</span>,  <span class="co"># Mínimo de elementos en nodo para que sea dividido</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>     min_samples_leaf<span class="op">=</span><span class="dv">10</span>,  <span class="co"># Mínimo de elementos en nodo para que sea dividido</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>     random_state<span class="op">=</span><span class="dv">12345</span>))</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_train_selected, ames_y_train)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predicciones-1" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-1">10.2 Predicciones</h3>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> ames_y_test)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred)</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">Sale_Price_Pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>161724.48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>141344.98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>94086.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>170907.29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>196400.31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>163644.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>124820.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>195305.76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>117240.69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>119017.53</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="métricas-de-desempeño-2" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-2">10.3 Métricas de desempeño</h3>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">35</span>  <span class="co"># Número de predictores </span></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>],</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>1339.13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>20865.26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>1015238204.14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>31862.80</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.85</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.84</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="gráficos-de-desempeño" class="level3">
<h3 class="anchored" data-anchor-id="gráficos-de-desempeño">10.4 Gráficos de desempeño</h3>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>, y <span class="op">=</span> <span class="st">"Sale_Price_Pred"</span>)) <span class="op">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">500000</span>] ) <span class="op">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 3 rows containing missing values.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\52554\Documents\.virtualenvs\venv_dsml_py3_10\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 53'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-84-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-85-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-86-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="validación-cruzada-2" class="level3">
<h3 class="anchored" data-anchor-id="validación-cruzada-2">10.5 Validación Cruzada</h3>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el objeto K-Fold Cross Validator</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span>k, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'max_depth'</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">8</span>),</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'min_samples_split'</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>),</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'min_samples_leaf'</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>),</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'max_features'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="métricas-de-desempeño-3" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-3">10.6 Métricas de desempeño</h3>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir las métricas de desempeño que deseas calcular como funciones de puntuación</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjusted_r2_score(y_true, y_pred, n, p):</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  adjusted_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r2) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> adjusted_r2</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>                      n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_train_selected)), p<span class="op">=</span><span class="bu">len</span>(ames_train_selected.columns)),</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipeline-y-modelado-2" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-y-modelado-2">10.7 Pipeline y modelado</h3>
<p>Se comentan las líneas: pipeline.fit y pickle.dump</p>
<p>Lo anterior debido a que fueron ejecutadas previamente dada la duración del proceso.</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'regressor'</span>, GridSearchCV(</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>      RandomForestRegressor(), </span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>      param_grid <span class="op">=</span> param_grid, </span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>      error_score<span class="op">=</span><span class="st">'raise'</span>)</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co">#******************************************************</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a><span class="co">#pipeline.fit(ames_train_selected, ames_y_train)</span></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="co">#pickle.dump(pipeline, open('models/grid_search_random_forest.pkl', 'wb'))</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a><span class="co">#******************************************************</span></span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'models/grid_search_random_forest.pkl'</span>, <span class="st">'rb'</span>))</span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>results_cv <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].cv_results_</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-de-dataframe-y-selección-de-columnas-de-interés" class="level3">
<h3 class="anchored" data-anchor-id="creación-de-dataframe-y-selección-de-columnas-de-interés">10.8 Creación de dataframe y selección de columnas de interés</h3>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convierte los resultados en un DataFrame</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">500</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame(results_cv)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>results_df.columns</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Puedes seleccionar las columnas de interés, por ejemplo:</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> (</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>  results_df <span class="op">&gt;&gt;</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>  select(<span class="op">-</span>_.contains(<span class="st">"split._"</span>), <span class="op">-</span>_.contains(<span class="st">"time"</span>), <span class="op">-</span>_.params)</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>summary_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">param_max_depth</th>
<th data-quarto-table-cell-role="th">param_max_features</th>
<th data-quarto-table-cell-role="th">param_min_samples_leaf</th>
<th data-quarto-table-cell-role="th">param_min_samples_split</th>
<th data-quarto-table-cell-role="th">mean_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">std_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">rank_test_neg_mean_squared_error</th>
<th data-quarto-table-cell-role="th">mean_test_r2</th>
<th data-quarto-table-cell-role="th">std_test_r2</th>
<th data-quarto-table-cell-role="th">rank_test_r2</th>
<th data-quarto-table-cell-role="th">mean_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">std_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">rank_test_neg_mean_absolute_error</th>
<th data-quarto-table-cell-role="th">mean_test_mape</th>
<th data-quarto-table-cell-role="th">std_test_mape</th>
<th data-quarto-table-cell-role="th">rank_test_mape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>-4927802265.62</td>
<td>536435986.18</td>
<td>3850</td>
<td>0.22</td>
<td>0.02</td>
<td>3853</td>
<td>-49973.86</td>
<td>1642.15</td>
<td>3856</td>
<td>-0.33</td>
<td>0.03</td>
<td>3853</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>-4858888602.91</td>
<td>619957359.53</td>
<td>3814</td>
<td>0.23</td>
<td>0.04</td>
<td>3814</td>
<td>-49540.26</td>
<td>1732.77</td>
<td>3817</td>
<td>-0.32</td>
<td>0.03</td>
<td>3819</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>-4865738879.40</td>
<td>659405920.19</td>
<td>3816</td>
<td>0.23</td>
<td>0.03</td>
<td>3815</td>
<td>-49535.33</td>
<td>1871.58</td>
<td>3816</td>
<td>-0.32</td>
<td>0.03</td>
<td>3816</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>5</td>
<td>-4987061074.81</td>
<td>637616462.30</td>
<td>3874</td>
<td>0.21</td>
<td>0.03</td>
<td>3876</td>
<td>-50175.64</td>
<td>1806.11</td>
<td>3868</td>
<td>-0.33</td>
<td>0.03</td>
<td>3862</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>6</td>
<td>-4946722573.92</td>
<td>557214698.66</td>
<td>3859</td>
<td>0.21</td>
<td>0.02</td>
<td>3863</td>
<td>-49964.15</td>
<td>1678.67</td>
<td>3853</td>
<td>-0.33</td>
<td>0.03</td>
<td>3850</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3883</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>6</td>
<td>-1319905570.56</td>
<td>278722713.09</td>
<td>258</td>
<td>0.79</td>
<td>0.03</td>
<td>251</td>
<td>-23056.83</td>
<td>1530.94</td>
<td>175</td>
<td>-0.15</td>
<td>0.02</td>
<td>150</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3884</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>7</td>
<td>-1332341323.49</td>
<td>281160842.81</td>
<td>294</td>
<td>0.79</td>
<td>0.03</td>
<td>293</td>
<td>-23136.21</td>
<td>1375.61</td>
<td>182</td>
<td>-0.15</td>
<td>0.02</td>
<td>156</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3885</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>8</td>
<td>-1337663318.36</td>
<td>290948796.95</td>
<td>307</td>
<td>0.79</td>
<td>0.03</td>
<td>301</td>
<td>-23203.88</td>
<td>1446.73</td>
<td>206</td>
<td>-0.15</td>
<td>0.02</td>
<td>171</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3886</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>9</td>
<td>-1309797234.12</td>
<td>285701415.05</td>
<td>232</td>
<td>0.79</td>
<td>0.04</td>
<td>223</td>
<td>-23003.05</td>
<td>1681.58</td>
<td>160</td>
<td>-0.15</td>
<td>0.02</td>
<td>125</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3887</td>
<td>7</td>
<td>8</td>
<td>10</td>
<td>10</td>
<td>-1332353051.50</td>
<td>274143072.29</td>
<td>295</td>
<td>0.79</td>
<td>0.03</td>
<td>287</td>
<td>-23183.01</td>
<td>1489.09</td>
<td>199</td>
<td>-0.15</td>
<td>0.02</td>
<td>167</td>
</tr>
</tbody>
</table>

<p>3888 rows × 16 columns</p>
</div>
</div>
</div>
</section>
<section id="creación-de-gráficos" class="level3">
<h3 class="anchored" data-anchor-id="creación-de-gráficos">10.9 Creación de gráficos</h3>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="op">&gt;&gt;</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"param_max_features"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, fill <span class="op">=</span> <span class="st">"param_max_depth"</span>)) <span class="op">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  geom_point() <span class="op">+</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de Random Forest vs R^2"</span>) <span class="op">+</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de features por árbol"</span>) <span class="op">+</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-91-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<p>Podemos apreciar modelos que van incrementando su <em>R2</em> a medida que se incrementan los <em>features</em> y con el mejor desempeño que cuentan con 8 <em>features</em> por árbol.</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="op">&gt;&gt;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  select(_.param_max_depth, _.param_max_features, _.param_min_samples_leaf, </span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>         _.param_min_samples_split, _.mean_test_r2) <span class="op">&gt;&gt;</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  pivot_longer(</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">"param_max_depth"</span>, <span class="st">"param_max_features"</span>, <span class="st">"param_min_samples_leaf"</span>, <span class="st">"param_min_samples_split"</span>],</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    names_to<span class="op">=</span><span class="st">"parameter"</span>,</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    values_to<span class="op">=</span><span class="st">"value"</span>) <span class="op">&gt;&gt;</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"value"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>)) <span class="op">+</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  geom_point(size <span class="op">=</span> <span class="dv">1</span>, ) <span class="op">+</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  facet_wrap(<span class="st">"~parameter"</span>, scales <span class="op">=</span> <span class="st">"free_x"</span>) <span class="op">+</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parameter value"</span>) <span class="op">+</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>) <span class="op">+</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de Random Forest vs R^2"</span>)</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-92-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].best_params_</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>best_params</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>best_estimator <span class="op">=</span> pipeline.named_steps[<span class="st">'regressor'</span>].best_estimator_</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>best_estimator</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor(max_depth=7, max_features=8, min_samples_leaf=2,
                      min_samples_split=4)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(max_depth=7, max_features=8, min_samples_leaf=2,
                      min_samples_split=4)</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="predicciones-finales-1" class="level3">
<h3 class="anchored" data-anchor-id="predicciones-finales-1">10.10 Predicciones finales</h3>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>final_rf_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>   (<span class="st">'regressor'</span>, best_estimator)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>final_rf_pipeline.fit(ames_train_selected, ames_y_train)</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Predicciones finales</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> final_rf_pipeline.predict(ames_x_test)</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>results_reg <span class="op">=</span> (</span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>  mutate(final_rf_pred <span class="op">=</span> y_pred_rf, Sale_Price <span class="op">=</span> ames_y_test) <span class="op">&gt;&gt;</span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.final_rf_pred)</span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>results_reg</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sale_Price</th>
<th data-quarto-table-cell-role="th">final_rf_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">390</td>
<td>165000</td>
<td>168078.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1235</td>
<td>124000</td>
<td>136940.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2288</td>
<td>75000</td>
<td>101390.46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">107</td>
<td>206000</td>
<td>159082.77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1861</td>
<td>190000</td>
<td>210353.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>171000</td>
<td>151416.63</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>120500</td>
<td>129943.40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1253</td>
<td>146000</td>
<td>187728.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">78</td>
<td>125000</td>
<td>121199.73</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">714</td>
<td>110000</td>
<td>116441.27</td>
</tr>
</tbody>
</table>

<p>586 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="métricas-de-desempeño-4" class="level3">
<h3 class="anchored" data-anchor-id="métricas-de-desempeño-4">10.11 Métricas de desempeño</h3>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred_rf)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred_rf)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred_rf)</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_obs, y_pred_rf)</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_obs, y_pred_rf)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>r2_adj <span class="op">=</span> adjusted_r2_score(y_true <span class="op">=</span> y_obs, y_pred <span class="op">=</span> y_pred_rf,</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_train_selected)), p<span class="op">=</span><span class="bu">len</span>(ames_train_selected.columns))</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R^2"</span>, <span class="st">"R^2 Adj"</span>],</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>metrics_df</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>ME</td>
<td>914.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MAE</td>
<td>21987.70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MAPE</td>
<td>0.13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MSE</td>
<td>1102375079.96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RMSE</td>
<td>33202.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>R^2</td>
<td>0.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>R^2 Adj</td>
<td>0.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="creación-de-gráficos-1" class="level3">
<h3 class="anchored" data-anchor-id="creación-de-gráficos-1">10.12 Creación de gráficos</h3>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  results_reg <span class="op">&gt;&gt;</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"final_rf_pred"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    xlab(<span class="st">"Prediction"</span>) <span class="op">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    ylab(<span class="st">"Observation"</span>) <span class="op">+</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>    ggtitle(<span class="st">"Comparisson"</span>)</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-96-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
<section id="importancia-de-variables-1" class="level3">
<h3 class="anchored" data-anchor-id="importancia-de-variables-1">10.13 Importancia de variables</h3>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 permutación</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> np.zeros(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>])</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Realiza el procedimiento de permutación</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>]):</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    ames_x_test_permuted <span class="op">=</span> ames_x_test[columnas_seleccionadas].copy()</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>    ames_x_test_permuted.iloc[:, i] <span class="op">=</span> shuffle(ames_x_test_permuted.iloc[:, i], random_state<span class="op">=</span><span class="dv">42</span>)  </span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Permuta una característica</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>    y_pred_permuted <span class="op">=</span> final_rf_pipeline.predict(ames_x_test_permuted)</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    mse_permuted <span class="op">=</span> mean_squared_error(ames_y_test, y_pred_permuted)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>    importance[i] <span class="op">=</span> mse <span class="op">-</span> mse_permuted</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcula la importancia relativa</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> importance <span class="op">/</span> importance.<span class="bu">sum</span>()</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>importance</span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: columnas_seleccionadas, </span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Importance'</span>: importance</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-de-gráficos-2" class="level3">
<h3 class="anchored" data-anchor-id="creación-de-gráficos-2">10.14 Creación de gráficos</h3>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x<span class="op">=</span> <span class="st">'reorder(Variable, Importance)'</span>, y<span class="op">=</span><span class="st">'Importance'</span>)) <span class="op">+</span> </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  geom_bar(stat<span class="op">=</span><span class="st">'identity'</span>, fill<span class="op">=</span><span class="st">'blue'</span>, color <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span> </span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-98-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># N permutaciones</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>n_permutations <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>performance_losses <span class="op">=</span> []</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(ames_x_test[columnas_seleccionadas].shape[<span class="dv">1</span>]):</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> []</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_permutations):</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        ames_x_test_permuted <span class="op">=</span> ames_x_test[columnas_seleccionadas].copy()</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        ames_x_test_permuted.iloc[:, i] <span class="op">=</span> np.random.permutation(ames_x_test_permuted.iloc[:, i])</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>        y_pred_permuted <span class="op">=</span> final_rf_pipeline.predict(ames_x_test_permuted)</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>        mse_permuted <span class="op">=</span> mean_squared_error(ames_y_test, y_pred_permuted)</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>        loss.append(mse_permuted)</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>    performance_losses.append(loss)</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>performance_losses <span class="op">=</span> performance_losses<span class="op">/</span>np.<span class="bu">sum</span>(performance_losses, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>mean_losses <span class="op">=</span> np.mean(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>std_losses <span class="op">=</span> np.std(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: columnas_seleccionadas, </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Mean_Loss'</span>: mean_losses, </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Std_Loss'</span>: std_losses</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-101-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> final_rf_pipeline.named_steps[<span class="st">'regressor'</span>].feature_importances_</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> final_rf_pipeline[<span class="st">"preprocessor"</span>].get_feature_names_out()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame({<span class="st">'feature'</span>: columns, <span class="st">'Importance'</span>: importances}) <span class="op">&gt;&gt;</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x<span class="op">=</span> <span class="st">'reorder(feature, Importance)'</span>, y<span class="op">=</span><span class="st">'Importance'</span>)) <span class="op">+</span> </span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  geom_bar(stat<span class="op">=</span><span class="st">'identity'</span>, fill<span class="op">=</span><span class="st">'blue'</span>, color <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span> </span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusión-final" class="level2">
<h2 class="anchored" data-anchor-id="conclusión-final"><strong>11. Conclusión final</strong></h2>
<p>La conclusión, habiendo probado modelos con Regresión Lineal, K Nearest Neighbor y Random Forest, es que KNN nos proporciona unas mejores métricas de desempeño, sin embargo, Random Forest se acerca bastante en su poder predictivo, y nos proporciona información muy importante, respecto de la importancia de las variables para el modelo.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>